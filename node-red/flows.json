[{"id":"6169ae85.ebde","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"6a24dcbb.10a694","type":"tab","label":"Освещение","disabled":false,"info":""},{"id":"c51c1272.f7fa8","type":"tab","label":"Климат","disabled":false,"info":""},{"id":"6962e153.99eb9","type":"server","z":"","name":"Home Assistant"},{"id":"ac5fa68f.43b8d8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"bdf418b.1f78be8","type":"server-events","z":"6169ae85.ebde","name":"","server":"6962e153.99eb9","event_type":"","x":260,"y":160,"wires":[["dcd94a39.c2b028","1f644bb0.a40ea4"]]},{"id":"8b72a936.b722f8","type":"debug","z":"6169ae85.ebde","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.event.click_type","targetType":"msg","x":1140,"y":220,"wires":[]},{"id":"37299de2.451802","type":"server-state-changed","z":"6169ae85.ebde","name":"если свет включен","server":"6962e153.99eb9","version":1,"entityidfilter":"switch.plug_158d0002677bd3","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":290,"y":440,"wires":[[]]},{"id":"26782993.75cb46","type":"switch","z":"6169ae85.ebde","name":"On - Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":520,"y":400,"wires":[["6130733.f6d238c"],["a2831a30.988158"]]},{"id":"6130733.f6d238c","type":"api-call-service","z":"6169ae85.ebde","name":"обогреватель","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":770,"y":480,"wires":[["e32edc6a.351c7"]]},{"id":"e32edc6a.351c7","type":"debug","z":"6169ae85.ebde","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1030,"y":400,"wires":[]},{"id":"a2831a30.988158","type":"api-call-service","z":"6169ae85.ebde","name":"обогреватель","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":560,"wires":[["e32edc6a.351c7"]]},{"id":"dcd94a39.c2b028","type":"switch","z":"6169ae85.ebde","name":"Переключатель/кнопка","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"binary_sensor.xiaomi_exit_switch_lobby_158d0002135c59","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":180,"wires":[["3da22e18.e8c702"]]},{"id":"3da22e18.e8c702","type":"switch","z":"6169ae85.ebde","name":"Кнопка на выходе. Тип нажатия","property":"payload.event.click_type","propertyType":"msg","rules":[{"t":"eq","v":"single","vt":"str"},{"t":"eq","v":"double","vt":"str"},{"t":"eq","v":"long_click_press","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":800,"y":80,"wires":[["8b72a936.b722f8","2841a9e6.18fbe6"],["8b72a936.b722f8","cbdadfef.70f29"],["8b72a936.b722f8"]]},{"id":"2841a9e6.18fbe6","type":"api-call-service","z":"6169ae85.ebde","name":"включить свет","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1100,"y":80,"wires":[[]]},{"id":"cbdadfef.70f29","type":"api-call-service","z":"6169ae85.ebde","name":"включить свет","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1100,"y":140,"wires":[[]]},{"id":"1f644bb0.a40ea4","type":"switch","z":"6169ae85.ebde","name":"Целевая влажность","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"input_number.xiaomi_humidifier_bedroom_target_hum","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":500,"y":240,"wires":[[]]},{"id":"7e5d8dc6.bc47d4","type":"debug","z":"6169ae85.ebde","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":280,"wires":[]},{"id":"ec4d0e83.075d","type":"server-state-changed","z":"6169ae85.ebde","name":"Целевая влажность","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.xiaomi_humidifier_bedroom_target_hum","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":310,"y":320,"wires":[["7e5d8dc6.bc47d4","d22711e6.2673d"]]},{"id":"b03516e7.89d998","type":"api-call-service","z":"6169ae85.ebde","name":"target hum","server":"6962e153.99eb9","version":1,"service_domain":"fan","service":"xiaomi_miio_set_target_humidity","entityId":"fan.xiaomi_humidifier_bedroom","data":"{\"humidity\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":620,"y":360,"wires":[["7e5d8dc6.bc47d4"]]},{"id":"2f76de6f.658c22","type":"inject","z":"6169ae85.ebde","name":"50","topic":"data","payload":"50","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":560,"wires":[["b03516e7.89d998","d22711e6.2673d"]]},{"id":"d22711e6.2673d","type":"debug","z":"6169ae85.ebde","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":490,"y":560,"wires":[]},{"id":"12c41a6a.f1de76","type":"server-state-changed","z":"6a24dcbb.10a694","name":"Движение в ванной","server":"6962e153.99eb9","version":1,"entityidfilter":"binary_sensor.xiaomi_motion_bathroom_158d0002b6e8e6","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":90,"y":100,"wires":[["fecba39c.3a198"],[]]},{"id":"b6033392.b4a27","type":"trigger","z":"6a24dcbb.10a694","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"5","extend":true,"units":"min","reset":"","bytopic":"all","name":"Выключение 5 минут","x":1060,"y":80,"wires":[["32aef640.2ec2fa","61c91bef.adffb4"]]},{"id":"fecba39c.3a198","type":"api-current-state","z":"6a24dcbb.10a694","name":"Режим авто включен?","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.auto_light_switch_bedroom","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":320,"y":100,"wires":[["80c4d1f9.db6f9"],[]]},{"id":"80c4d1f9.db6f9","type":"api-current-state","z":"6a24dcbb.10a694","name":"Свет включен?","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.gateway_light_7c49eb1babbf","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":540,"y":100,"wires":[["a35bf8a1.61f748"],["190ed18e.6376ee"]]},{"id":"a35bf8a1.61f748","type":"switch","z":"6a24dcbb.10a694","name":"Автоматизация?","property":"my_auto","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":60,"wires":[["b6033392.b4a27"]]},{"id":"dc42f363.01c3","type":"change","z":"6a24dcbb.10a694","name":"Старт автоматизации ","rules":[{"t":"set","p":"my_auto","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":200,"wires":[[]]},{"id":"32aef640.2ec2fa","type":"change","z":"6a24dcbb.10a694","name":"Стоп автоматизация","rules":[{"t":"set","p":"my_auto","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1340,"y":60,"wires":[[]]},{"id":"20483881.10cf38","type":"api-call-service","z":"6a24dcbb.10a694","name":"Включить свет","server":"6962e153.99eb9","version":1,"service_domain":"light","service":"turn_on","entityId":"light.gateway_light_7c49eb1babbf","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1040,"y":140,"wires":[[]]},{"id":"61c91bef.adffb4","type":"api-call-service","z":"6a24dcbb.10a694","name":"Выключить свет","server":"6962e153.99eb9","version":1,"service_domain":"light","service":"turn_off","entityId":"light.gateway_light_7c49eb1babbf","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":100,"wires":[[]]},{"id":"190ed18e.6376ee","type":"api-current-state","z":"6a24dcbb.10a694","name":"< 50 lx","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"50","halt_if_type":"num","halt_if_compare":"lt","override_topic":false,"entity_id":"sensor.xiaomi_illumin_bathroom_158d0002b6e8e6","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":730,"y":140,"wires":[["b6033392.b4a27","20483881.10cf38","dc42f363.01c3"],[]]},{"id":"88084487.2a71c8","type":"comment","z":"6a24dcbb.10a694","name":"Подсветка в ванной","info":"","x":90,"y":40,"wires":[]},{"id":"83ce2c07.fbaa3","type":"server-events","z":"6a24dcbb.10a694","name":"","server":"6962e153.99eb9","event_type":"","x":80,"y":480,"wires":[["1079ba9.3aa4d45","43b2920d.b57dbc"]]},{"id":"56d40b0d.bacb94","type":"debug","z":"6a24dcbb.10a694","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":540,"wires":[]},{"id":"1079ba9.3aa4d45","type":"switch","z":"6a24dcbb.10a694","name":"Переключатель/кнопка","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"binary_sensor.xiaomi_exit_switch_lobby_158d0002135c59","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":420,"wires":[["2a8182fb.79f1de"]]},{"id":"2a8182fb.79f1de","type":"switch","z":"6a24dcbb.10a694","name":"Кнопка на выходе. Тип нажатия","property":"payload.event.click_type","propertyType":"msg","rules":[{"t":"eq","v":"single","vt":"str"},{"t":"eq","v":"double","vt":"str"},{"t":"eq","v":"long_click_press","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":620,"y":420,"wires":[["56d40b0d.bacb94","e8e4b586.dc8d78"],["56d40b0d.bacb94","6be51d53.94b124"],["56d40b0d.bacb94"]]},{"id":"e8e4b586.dc8d78","type":"api-call-service","z":"6a24dcbb.10a694","name":"Включить свет","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":400,"wires":[[]]},{"id":"6be51d53.94b124","type":"api-call-service","z":"6a24dcbb.10a694","name":"Выключить свет","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":460,"wires":[[]]},{"id":"43b2920d.b57dbc","type":"switch","z":"6a24dcbb.10a694","name":"Выключатель на шкафу","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"binary_sensor.xiaomi_wall_switch_bedroom_158d000230d4a2","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":340,"wires":[["90ab1a30.408168"]]},{"id":"90ab1a30.408168","type":"api-call-service","z":"6a24dcbb.10a694","name":"Включить ночник","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"toggle","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":590,"y":340,"wires":[[]]},{"id":"618e821.e9bd37c","type":"comment","z":"6a24dcbb.10a694","name":"Реагирование на события","info":"","x":110,"y":300,"wires":[]},{"id":"a0b35db8.b6673","type":"server-state-changed","z":"c51c1272.f7fa8","name":"Мин температура днем","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.auto_temp_day_min_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":130,"y":220,"wires":[["b852ea13.288fd8"]]},{"id":"e83127b4.5d6dc8","type":"server-state-changed","z":"c51c1272.f7fa8","name":"Мин температура ночью","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.auto_temp_night_min_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":130,"y":260,"wires":[["b852ea13.288fd8"]]},{"id":"849ddfb3.d076","type":"server-state-changed","z":"c51c1272.f7fa8","name":"Изменение диапазона","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.auto_temp_range_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":180,"wires":[["b852ea13.288fd8"]]},{"id":"f0b135cd.5e1c48","type":"server-state-changed","z":"c51c1272.f7fa8","name":"Изменение температуры","server":"6962e153.99eb9","version":1,"entityidfilter":"sensor.xiaomi_thp_temperature_loggia_158d0002389f84","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":130,"y":100,"wires":[["b852ea13.288fd8"]]},{"id":"b852ea13.288fd8","type":"api-current-state","z":"c51c1272.f7fa8","name":"Auto heat on?","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.auto_temp_heater_switch_loggia","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":420,"y":140,"wires":[["f9c3c53.a1d2938","2225b2f0.7421fe","5325feff.37679","261ddedd.7f52a2","28129498.b1bf0c","d6666b8d.e6fd58"],[]]},{"id":"8d5260bc.c7112","type":"debug","z":"c51c1272.f7fa8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1410,"y":220,"wires":[]},{"id":"7236e29a.1cf7ec","type":"change","z":"c51c1272.f7fa8","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"day_temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":60,"wires":[["9730a72a.0c10b8"]]},{"id":"9730a72a.0c10b8","type":"join","z":"c51c1272.f7fa8","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"6","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1010,"y":140,"wires":[["45dad06d.e27cb","d16ed62a.2a67c8"]]},{"id":"f9c3c53.a1d2938","type":"api-current-state","z":"c51c1272.f7fa8","name":"Дневная T","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.auto_temp_day_min_loggia","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":650,"y":60,"wires":[["7236e29a.1cf7ec"]]},{"id":"2225b2f0.7421fe","type":"api-current-state","z":"c51c1272.f7fa8","name":"Ночная T","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.auto_temp_night_min_loggia","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":640,"y":100,"wires":[["2a5295f.ed2956a"]]},{"id":"2a5295f.ed2956a","type":"change","z":"c51c1272.f7fa8","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"night_temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":100,"wires":[["9730a72a.0c10b8"]]},{"id":"45dad06d.e27cb","type":"debug","z":"c51c1272.f7fa8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1210,"y":220,"wires":[]},{"id":"5325feff.37679","type":"api-current-state","z":"c51c1272.f7fa8","name":"Диапазон","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.auto_temp_range_loggia","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":640,"y":140,"wires":[["c54e12e4.37822"]]},{"id":"c54e12e4.37822","type":"change","z":"c51c1272.f7fa8","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"range","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":140,"wires":[["9730a72a.0c10b8"]]},{"id":"261ddedd.7f52a2","type":"api-current-state","z":"c51c1272.f7fa8","name":"Температура","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.xiaomi_thp_temperature_loggia_158d0002389f84","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":660,"y":180,"wires":[["36fc0e35.2f48d2"]]},{"id":"36fc0e35.2f48d2","type":"change","z":"c51c1272.f7fa8","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":180,"wires":[["9730a72a.0c10b8"]]},{"id":"28129498.b1bf0c","type":"time-range-switch","z":"c51c1272.f7fa8","name":"","lat":"55.65606","lon":"37.74136","startTime":"07:00","endTime":"23:00","startOffset":0,"endOffset":0,"x":650,"y":280,"wires":[["791edf91.e8971"],["cbdfe360.a620f"]]},{"id":"791edf91.e8971","type":"change","z":"c51c1272.f7fa8","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"time","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"day","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":260,"wires":[["9730a72a.0c10b8"]]},{"id":"cbdfe360.a620f","type":"change","z":"c51c1272.f7fa8","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"time","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"night","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":300,"wires":[["9730a72a.0c10b8"]]},{"id":"d16ed62a.2a67c8","type":"function","z":"c51c1272.f7fa8","name":"Управление","func":"var time=msg.payload.time;\nvar day_temp=msg.payload.day_temp;\nvar night_temp=msg.payload.night_temp;\nvar range=msg.payload.range;\nvar curr_temp=msg.payload.temp;\nvar heater=msg.payload.heater\n\n// Период\nif (time==\"day\"){\n    if ((curr_temp < day_temp) && (heater=='off')){\n        msg.payload=\"on\"; // Включить обогреватель\n        return msg;\n    }\n    if ((curr_temp > (day_temp + range)) && (heater=='on')){\n        msg.payload=\"off\"; // Выключить обогреватель\n        return msg;\n    }\n}\nif (time==\"night\"){\n    if ((curr_temp < night_temp) && (heater=='off')){\n        msg.payload=\"on\"; // Включить обогреватель\n        return msg;\n    }\n    if ((curr_temp > (night_temp + range)) && (heater=='on')){\n        msg.payload=\"off\"; // Выключить обогреватель\n        return msg;\n    }\n}\nmsg.payload=null\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":140,"wires":[["53c2fd90.c46cd4","8d5260bc.c7112"]]},{"id":"53c2fd90.c46cd4","type":"switch","z":"c51c1272.f7fa8","name":"On/Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1290,"y":140,"wires":[["7dfe14ea.9abcac"],["46458297.c821cc"]]},{"id":"7dfe14ea.9abcac","type":"api-call-service","z":"c51c1272.f7fa8","name":"Включить обогреватель","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1490,"y":100,"wires":[[]]},{"id":"46458297.c821cc","type":"api-call-service","z":"c51c1272.f7fa8","name":"Выключить обогреватель","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1500,"y":160,"wires":[[]]},{"id":"8c70391d.69d7f8","type":"comment","z":"c51c1272.f7fa8","name":"Автоматический подогрев лоджии","info":"","x":160,"y":20,"wires":[]},{"id":"caf44b1a.7943c8","type":"server-state-changed","z":"c51c1272.f7fa8","name":"Включение авто подогрева","server":"6962e153.99eb9","version":1,"entityidfilter":"input_boolean.auto_temp_heater_switch_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":60,"wires":[["b852ea13.288fd8"]]},{"id":"46b6571b.1f9018","type":"timerswitch","z":"c51c1272.f7fa8","name":"07:00 & 23:00","ontopic":"","offtopic":"","onpayload":"time","offpayload":"time","disabled":false,"schedules":[{"on_h":"07","on_m":"00","on_s":"00","off_h":"23","off_m":"00","off_s":"00","valid":true}],"x":100,"y":140,"wires":[["b852ea13.288fd8"]]},{"id":"d6666b8d.e6fd58","type":"api-current-state","z":"c51c1272.f7fa8","name":"Обогреватель","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.plug_158d00032d5e8b","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":660,"y":220,"wires":[["e1ae664b.962348"]]},{"id":"e1ae664b.962348","type":"change","z":"c51c1272.f7fa8","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"heater","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":220,"wires":[["9730a72a.0c10b8"]]}]