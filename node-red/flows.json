[{"id":"6169ae85.ebde","type":"tab","label":"–ü—Ä–∏–º–µ—Ä—ã","disabled":true,"info":""},{"id":"6a24dcbb.10a694","type":"tab","label":"–û—Å–≤–µ—â–µ–Ω–∏–µ","disabled":false,"info":""},{"id":"8d422126.121a1","type":"tab","label":"–û–ø–æ–≤–µ—â–µ–Ω–∏—è","disabled":false,"info":""},{"id":"16ff52c4.88944d","type":"tab","label":"–ö–ª–∏–º–∞—Ç","disabled":false,"info":""},{"id":"ee1a9216.12937","type":"tab","label":"–¢–µ—Å—Ç","disabled":false,"info":""},{"id":"7cf1202f.0fec5","type":"subflow","name":"2-T-trigger","info":"# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ\n2-T-Trigger –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ input –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ —Ç—Ä–µ—à—Ö–æ–ª–¥–æ–≤.\n# Input\n–ü—Ä–∏–Ω–∏–º–∞–µ—Ç —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è msg.payload, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —Ç—Ä–µ—à—Ö–æ–ª–¥–∞–º–∏\n# Parameters\n**low** - –Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞\n\n**high** - –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞\n\n**hysteresis** - –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å. –ü–æ–∑–≤–æ–ª—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–µ–±–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è. –ù–æ–¥–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –º–µ–Ω–µ–µ, —á–µ–º –Ω–∞ –≤–µ–ª–∏—á–∏–Ω—É –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. \n\n# Output\n * –¢–µ–∫—É—â–∏–π msg.payload –ø–æ–º–µ—â–∞–µ—Ç –≤ msg.value\n * –ó–∞–º–µ–Ω—è–µ—Ç msg.payload –Ω–∞:\n    * **low** - –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∏–∂–µ low\n    * **high** - –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã—à–µ high\n    * **normal** - –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ–∂–¥—É low –∏ high","category":"","in":[{"x":60,"y":140,"wires":[{"id":"6b4dd9c9.6c54f8"}]}],"out":[{"x":880,"y":140,"wires":[{"id":"b50f5b7b.baa748","port":0}]}],"env":[{"name":"low","type":"num","value":""},{"name":"high","type":"num","value":""},{"name":"hysteresis","type":"str","value":"0"}],"icon":"node-red-contrib-home-assistant-websocket/trigger.png"},{"id":"6962e153.99eb9","type":"server","z":"","name":"Home Assistant"},{"id":"ac5fa68f.43b8d8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"2b17670e.b5c0f8","type":"server","z":"","name":"Home Assistant","legacy":false,"hassio":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"90767615.7eb998","type":"server","z":"","name":"Home Assistant","legacy":false,"hassio":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":false},{"id":"12c41a6a.f1de76","type":"server-state-changed","z":"6a24dcbb.10a694","name":"–î–≤–∏–∂–µ–Ω–∏–µ –≤ –≤–∞–Ω–Ω–æ–π","server":"6962e153.99eb9","version":1,"entityidfilter":"binary_sensor.xiaomi_motion_bathroom_158d0002b6e8e6","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":100,"wires":[["fecba39c.3a198"],[]]},{"id":"b6033392.b4a27","type":"trigger","z":"6a24dcbb.10a694","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"5","extend":true,"units":"min","reset":"","bytopic":"all","name":"–í—ã–∫–ª—é—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç","x":1060,"y":80,"wires":[["32aef640.2ec2fa","61c91bef.adffb4"]]},{"id":"fecba39c.3a198","type":"api-current-state","z":"6a24dcbb.10a694","name":"–†–µ–∂–∏–º –∞–≤—Ç–æ –≤–∫–ª—é—á–µ–Ω?","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.auto_light_switch_bedroom","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":340,"y":100,"wires":[["80c4d1f9.db6f9"],[]]},{"id":"80c4d1f9.db6f9","type":"api-current-state","z":"6a24dcbb.10a694","name":"–°–≤–µ—Ç –≤–∫–ª—é—á–µ–Ω?","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.gateway_light_7c49eb1babbf","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":560,"y":100,"wires":[["a35bf8a1.61f748"],["190ed18e.6376ee"]]},{"id":"a35bf8a1.61f748","type":"switch","z":"6a24dcbb.10a694","name":"–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è?","property":"my_auto","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":60,"wires":[["b6033392.b4a27"]]},{"id":"dc42f363.01c3","type":"change","z":"6a24dcbb.10a694","name":"–°—Ç–∞—Ä—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ ","rules":[{"t":"set","p":"my_auto","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":200,"wires":[[]]},{"id":"32aef640.2ec2fa","type":"change","z":"6a24dcbb.10a694","name":"–°—Ç–æ–ø –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è","rules":[{"t":"set","p":"my_auto","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1340,"y":60,"wires":[[]]},{"id":"20483881.10cf38","type":"api-call-service","z":"6a24dcbb.10a694","name":"–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç","server":"6962e153.99eb9","version":1,"service_domain":"light","service":"turn_on","entityId":"light.gateway_light_7c49eb1babbf","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1040,"y":140,"wires":[[]]},{"id":"61c91bef.adffb4","type":"api-call-service","z":"6a24dcbb.10a694","name":"–í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç","server":"6962e153.99eb9","version":1,"service_domain":"light","service":"turn_off","entityId":"light.gateway_light_7c49eb1babbf","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":100,"wires":[[]]},{"id":"190ed18e.6376ee","type":"api-current-state","z":"6a24dcbb.10a694","name":"< 50 lx","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"50","halt_if_type":"num","halt_if_compare":"lt","override_topic":false,"entity_id":"sensor.xiaomi_illumin_bathroom_158d0002b6e8e6","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":730,"y":140,"wires":[["b6033392.b4a27","20483881.10cf38","dc42f363.01c3"],[]]},{"id":"88084487.2a71c8","type":"comment","z":"6a24dcbb.10a694","name":"–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤ –≤–∞–Ω–Ω–æ–π","info":"","x":110,"y":40,"wires":[]},{"id":"83ce2c07.fbaa3","type":"server-events","z":"6a24dcbb.10a694","name":"","server":"6962e153.99eb9","event_type":"","x":80,"y":480,"wires":[["1079ba9.3aa4d45","43b2920d.b57dbc"]]},{"id":"56d40b0d.bacb94","type":"debug","z":"6a24dcbb.10a694","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":540,"wires":[]},{"id":"1079ba9.3aa4d45","type":"switch","z":"6a24dcbb.10a694","name":"–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å/–∫–Ω–æ–ø–∫–∞","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"binary_sensor.xiaomi_exit_switch_lobby_158d0002135c59","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":420,"wires":[["2a8182fb.79f1de"]]},{"id":"2a8182fb.79f1de","type":"switch","z":"6a24dcbb.10a694","name":"–ö–Ω–æ–ø–∫–∞ –Ω–∞ –≤—ã—Ö–æ–¥–µ. –¢–∏–ø –Ω–∞–∂–∞—Ç–∏—è","property":"payload.event.click_type","propertyType":"msg","rules":[{"t":"eq","v":"single","vt":"str"},{"t":"eq","v":"double","vt":"str"},{"t":"eq","v":"long_click_press","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":620,"y":420,"wires":[["56d40b0d.bacb94","e8e4b586.dc8d78"],["56d40b0d.bacb94","6be51d53.94b124"],["56d40b0d.bacb94"]]},{"id":"e8e4b586.dc8d78","type":"api-call-service","z":"6a24dcbb.10a694","name":"–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":400,"wires":[[]]},{"id":"6be51d53.94b124","type":"api-call-service","z":"6a24dcbb.10a694","name":"–í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":460,"wires":[[]]},{"id":"43b2920d.b57dbc","type":"switch","z":"6a24dcbb.10a694","name":"–í—ã–∫–ª—é—á–∞—Ç–µ–ª—å –Ω–∞ —à–∫–∞—Ñ—É","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"binary_sensor.xiaomi_wall_switch_bedroom_158d000230d4a2","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":340,"wires":[["90ab1a30.408168"]]},{"id":"90ab1a30.408168","type":"api-call-service","z":"6a24dcbb.10a694","name":"–í–∫–ª—é—á–∏—Ç—å –Ω–æ—á–Ω–∏–∫","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"toggle","entityId":"switch.plug_158d0002677bd3","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":590,"y":340,"wires":[[]]},{"id":"618e821.e9bd37c","type":"comment","z":"6a24dcbb.10a694","name":"–†–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–æ–±—ã—Ç–∏—è","info":"","x":130,"y":300,"wires":[]},{"id":"a1145bd3.bfae58","type":"api-call-service","z":"6169ae85.ebde","name":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å push","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"all_notifiers_push","entityId":"","data":"{\"message\":\"–¢–µ—Å—Ç–æ–≤–∞—è –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è\",\"title\":\"–ó–∞–≥–æ–ª–æ–≤–æ–∫ Push\",\"data\":{\"subtitle\":\"–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫\",\"push\":{\"thread-id\":\"example-notification-group\",\"badge\":\"0\"}}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":290,"y":80,"wires":[[]]},{"id":"fe8a5729.082a78","type":"inject","z":"6169ae85.ebde","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":80,"wires":[["a1145bd3.bfae58"]]},{"id":"6882506e.d0647","type":"api-call-service","z":"6169ae85.ebde","name":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∏–Ω–∞–º. push","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"all_notifiers_push","entityId":"","data":"{\"message\":\"{{payload}}\",\"title\":\"–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π PUSH —Å –¥–µ–π—Å—Ç–≤–∏–µ–º\",\"data\":{\"subtitle\":\"–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫\",\"push\":{\"thread-id\":\"example-notification-group\",\"badge\":\"0\"}}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":310,"y":180,"wires":[[]]},{"id":"1dd13918.951957","type":"inject","z":"6169ae85.ebde","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":180,"wires":[["6882506e.d0647"]]},{"id":"f045470a.3be468","type":"comment","z":"6169ae85.ebde","name":"Push —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º","info":"","x":160,"y":140,"wires":[]},{"id":"50773b7c.75efe4","type":"api-call-service","z":"6169ae85.ebde","name":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∏–Ω–∞–º. push —Å action","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"all_notifiers_push","entityId":"","data":"{\"message\":\"{{payload}}\",\"title\":\"–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π PUSH —Å –¥–µ–π—Å—Ç–≤–∏–µ–º\",\"data\":{\"subtitle\":\"–ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—è\",\"push\":{\"category\":\"test\",\"thread-id\":\"example-notification-group\",\"badge\":\"0\"}}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":340,"y":280,"wires":[[]]},{"id":"13527367.ad6bbd","type":"inject","z":"6169ae85.ebde","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":280,"wires":[["50773b7c.75efe4"]]},{"id":"991c69b4.d8e408","type":"comment","z":"6169ae85.ebde","name":"Push —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏ –¥–µ–π—Å—Ç–≤–∏–µ–º!","info":"","x":210,"y":240,"wires":[]},{"id":"5710f1bf.20b96","type":"comment","z":"6169ae85.ebde","name":"Push —Å –æ–±—ã—á–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º","info":"","x":150,"y":40,"wires":[]},{"id":"92afee7d.b04e1","type":"debug","z":"ee1a9216.12937","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":410,"y":140,"wires":[]},{"id":"8a7dddc6.196c4","type":"trigger-state","z":"8d422126.121a1","name":"–í–æ–¥–∞ –≤ –±–∞–∫–µ < 25%","server":"6962e153.99eb9","entityid":"sensor.xiaomi_humidifier_bedroom_water_level","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"rf8soktow1","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"25"},{"id":"6ehtgtm70z6","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"25"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"num","x":110,"y":180,"wires":[["dc113e4d.bc0c8"],[]]},{"id":"7c1c29ec.41c5d8","type":"server-events","z":"ee1a9216.12937","name":"","server":"6962e153.99eb9","event_type":"telegram_callback","x":130,"y":80,"wires":[["92afee7d.b04e1"]]},{"id":"c377506d.8d0e4","type":"server-events","z":"ee1a9216.12937","name":"","server":"6962e153.99eb9","event_type":"telegram_text","x":120,"y":140,"wires":[["92afee7d.b04e1"]]},{"id":"9dcf9d63.a4ec7","type":"server-events","z":"ee1a9216.12937","name":"","server":"6962e153.99eb9","event_type":"telegram_command","x":140,"y":200,"wires":[["92afee7d.b04e1"]]},{"id":"42f51315.87a1ec","type":"server-events","z":"8d422126.121a1","name":"","server":"6962e153.99eb9","event_type":"telegram_callback","x":130,"y":1060,"wires":[["516a7507.6b91cc","e271f256.4b363"]]},{"id":"e271f256.4b363","type":"switch","z":"8d422126.121a1","name":"–í—ã–±–æ—Ä chat_id","property":"payload.event.chat_id","propertyType":"msg","rules":[{"t":"else"}],"checkall":"true","repair":false,"outputs":1,"x":400,"y":860,"wires":[["d66d1eed.fcf28"]]},{"id":"d66d1eed.fcf28","type":"function","z":"8d422126.121a1","name":"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö","func":"msg.payload = \n{\n    \"message_id\": Number(msg.payload.event.message.message_id),\n    \"chat_id\": Number(msg.payload.event.chat_id),\n    \"message_text\": msg.payload.event.message.text.replace(/\\n/g, '\\\\n')\n}\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":860,"wires":[["7eadc5a4.b9d95c"]]},{"id":"7adcce9e.05936","type":"debug","z":"8d422126.121a1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1070,"y":860,"wires":[]},{"id":"7eadc5a4.b9d95c","type":"api-call-service","z":"8d422126.121a1","name":"Edit previous message","server":"6962e153.99eb9","version":1,"service_domain":"telegram_bot","service":"edit_message","entityId":"","data":"{\"message_id\":\"{{payload.message_id}}\",\"chat_id\":\"{{payload.chat_id}}\",\"message\":\"{{payload.message_text}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":860,"y":860,"wires":[["7adcce9e.05936"]]},{"id":"b981bdbd.e0c28","type":"comment","z":"8d422126.121a1","name":"Buttons delete after click","info":"","x":430,"y":820,"wires":[]},{"id":"da3d1ddf.1c785","type":"server-events","z":"8d422126.121a1","name":"","server":"6962e153.99eb9","event_type":"telegram_command","x":140,"y":1440,"wires":[["ce22c5f7.4b4868","a370a665.21b378"]]},{"id":"ce22c5f7.4b4868","type":"switch","z":"8d422126.121a1","name":"","property":"payload.event.command","propertyType":"msg","rules":[{"t":"eq","v":"/–ø–æ—Ü–µ–ª—É–π","vt":"str"},{"t":"eq","v":"/—Ü–µ–ª—É–π","vt":"str"},{"t":"eq","v":"/–ü–æ—Ü–µ–ª—É–π","vt":"str"},{"t":"eq","v":"/–¶–µ–ª—É–π","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":370,"y":1500,"wires":[["a7239212.c51ca"],["a7239212.c51ca"],["a7239212.c51ca"],["a7239212.c51ca"]]},{"id":"603720e8.f1aed","type":"debug","z":"8d422126.121a1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":1500,"wires":[]},{"id":"a7239212.c51ca","type":"api-call-service","z":"8d422126.121a1","name":"Send telegram msg","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_all","entityId":"","data":"{\"title\":\"*–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã*\",\"message\":\"–¶–µ–ª—É—é {{payload.event.args.0}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":1500,"wires":[["603720e8.f1aed"]]},{"id":"817d4e5d.95921","type":"comment","z":"ee1a9216.12937","name":"–ü—Ä–æ—Å–ª—É—à–∫–∞ —Ç–µ–ª–µ–≥—Ä–∞–º —ç–≤–µ–Ω—Ç–æ–≤","info":"","x":150,"y":40,"wires":[]},{"id":"a4eb1569.fab608","type":"function","z":"6169ae85.ebde","name":"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö","func":"msg.payload = \n{\n    \"message_id\": Number(msg.payload.event.message.message_id),\n    \"chat_id\": Number(msg.payload.event.chat_id),\n    \"message_text\": msg.payload.event.message.text.replace(/\\n/g, '\\\\n')\n}\nreturn msg;","outputs":1,"noerr":0,"x":120,"y":380,"wires":[["ab24e64f.b73608"]]},{"id":"ab24e64f.b73608","type":"api-call-service","z":"6169ae85.ebde","name":"Edit previous message","server":"6962e153.99eb9","version":1,"service_domain":"telegram_bot","service":"edit_message","entityId":"","data":"{\"message_id\":\"{{payload.message_id}}\",\"chat_id\":\"{{payload.chat_id}}\",\"message\":\"{{payload.message_text}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":360,"y":380,"wires":[[]]},{"id":"ed7c6eda.b07c4","type":"comment","z":"6169ae85.ebde","name":"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º","info":"","x":200,"y":340,"wires":[]},{"id":"509e4168.6acee","type":"comment","z":"8d422126.121a1","name":"–ö–æ–º–∞–Ω–¥—ã –ø–æ—Ü–µ–ª—É–µ–≤","info":"","x":410,"y":1440,"wires":[]},{"id":"ae68b544.c1a7f8","type":"server-state-changed","z":"16ff52c4.88944d","name":"–ú–∏–Ω —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–Ω–µ–º","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.auto_temp_day_min_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":130,"y":220,"wires":[["41442ad6.b2a134"]]},{"id":"ca2e9cfe.09056","type":"server-state-changed","z":"16ff52c4.88944d","name":"–ú–∏–Ω —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–æ—á—å—é","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.auto_temp_night_min_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":130,"y":260,"wires":[["41442ad6.b2a134"]]},{"id":"57733067.12e46","type":"server-state-changed","z":"16ff52c4.88944d","name":"–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.auto_temp_range_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":180,"wires":[["41442ad6.b2a134"]]},{"id":"7ccefdc3.a970c4","type":"server-state-changed","z":"16ff52c4.88944d","name":"–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã","server":"6962e153.99eb9","version":1,"entityidfilter":"sensor.xiaomi_thp_temperature_loggia_158d0002389f84","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":130,"y":100,"wires":[["41442ad6.b2a134"]]},{"id":"41442ad6.b2a134","type":"api-current-state","z":"16ff52c4.88944d","name":"Auto heat on?","server":"6962e153.99eb9","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.auto_temp_heater_switch_loggia","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":420,"y":140,"wires":[["372ee55.28e691a","3c0e38c8.d110c8","7f827176.df472","51d8a594.84c39c","ad0e3938.e83138","65304db2.42eeb4"],[]]},{"id":"a44a9133.dc675","type":"debug","z":"16ff52c4.88944d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1410,"y":220,"wires":[]},{"id":"721ea32e.aeb61c","type":"change","z":"16ff52c4.88944d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"day_temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":60,"wires":[["5b7a751b.00ddec"]]},{"id":"5b7a751b.00ddec","type":"join","z":"16ff52c4.88944d","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"6","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1010,"y":140,"wires":[["ea3311f1.5c59a","dbc5130.4510cf"]]},{"id":"372ee55.28e691a","type":"api-current-state","z":"16ff52c4.88944d","name":"–î–Ω–µ–≤–Ω–∞—è T","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.auto_temp_day_min_loggia","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":650,"y":60,"wires":[["721ea32e.aeb61c"]]},{"id":"3c0e38c8.d110c8","type":"api-current-state","z":"16ff52c4.88944d","name":"–ù–æ—á–Ω–∞—è T","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.auto_temp_night_min_loggia","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":640,"y":100,"wires":[["2e9e6624.96bfaa"]]},{"id":"2e9e6624.96bfaa","type":"change","z":"16ff52c4.88944d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"night_temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":100,"wires":[["5b7a751b.00ddec"]]},{"id":"ea3311f1.5c59a","type":"debug","z":"16ff52c4.88944d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1210,"y":220,"wires":[]},{"id":"7f827176.df472","type":"api-current-state","z":"16ff52c4.88944d","name":"–î–∏–∞–ø–∞–∑–æ–Ω","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.auto_temp_range_loggia","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":640,"y":140,"wires":[["e7b1d6e4.1a4768"]]},{"id":"e7b1d6e4.1a4768","type":"change","z":"16ff52c4.88944d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"range","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":140,"wires":[["5b7a751b.00ddec"]]},{"id":"51d8a594.84c39c","type":"api-current-state","z":"16ff52c4.88944d","name":"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.xiaomi_thp_temperature_loggia_158d0002389f84","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":660,"y":180,"wires":[["609c1bae.89cbd4"]]},{"id":"609c1bae.89cbd4","type":"change","z":"16ff52c4.88944d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":180,"wires":[["5b7a751b.00ddec"]]},{"id":"ad0e3938.e83138","type":"time-range-switch","z":"16ff52c4.88944d","name":"","lat":"55.65606","lon":"37.74136","startTime":"07:00","endTime":"23:00","startOffset":0,"endOffset":0,"x":650,"y":280,"wires":[["a548b2d2.10a49"],["3f5dc86e.f73148"]]},{"id":"a548b2d2.10a49","type":"change","z":"16ff52c4.88944d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"time","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"day","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":260,"wires":[["5b7a751b.00ddec"]]},{"id":"3f5dc86e.f73148","type":"change","z":"16ff52c4.88944d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"time","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"night","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":300,"wires":[["5b7a751b.00ddec"]]},{"id":"dbc5130.4510cf","type":"function","z":"16ff52c4.88944d","name":"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ","func":"var time=msg.payload.time;\nvar day_temp=msg.payload.day_temp;\nvar night_temp=msg.payload.night_temp;\nvar range=msg.payload.range;\nvar curr_temp=msg.payload.temp;\nvar heater=msg.payload.heater\n\n// –ü–µ—Ä–∏–æ–¥\nif (time==\"day\"){\n    if ((curr_temp < day_temp) && (heater=='off')){\n        msg.payload=\"on\"; // –í–∫–ª—é—á–∏—Ç—å –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å\n        return msg;\n    }\n    if ((curr_temp > (day_temp + range)) && (heater=='on')){\n        msg.payload=\"off\"; // –í—ã–∫–ª—é—á–∏—Ç—å –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å\n        return msg;\n    }\n}\nif (time==\"night\"){\n    if ((curr_temp < night_temp) && (heater=='off')){\n        msg.payload=\"on\"; // –í–∫–ª—é—á–∏—Ç—å –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å\n        return msg;\n    }\n    if ((curr_temp > (night_temp + range)) && (heater=='on')){\n        msg.payload=\"off\"; // –í—ã–∫–ª—é—á–∏—Ç—å –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å\n        return msg;\n    }\n}\nmsg.payload=null\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":140,"wires":[["ec57a7bd.7ff768","a44a9133.dc675"]]},{"id":"ec57a7bd.7ff768","type":"switch","z":"16ff52c4.88944d","name":"On/Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1290,"y":140,"wires":[["a45ce48b.ca68b8"],["7539b87a.f08508"]]},{"id":"a45ce48b.ca68b8","type":"api-call-service","z":"16ff52c4.88944d","name":"–í–∫–ª—é—á–∏—Ç—å –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1490,"y":100,"wires":[[]]},{"id":"7539b87a.f08508","type":"api-call-service","z":"16ff52c4.88944d","name":"–í—ã–∫–ª—é—á–∏—Ç—å –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1500,"y":160,"wires":[[]]},{"id":"79e92951.9e50e8","type":"comment","z":"16ff52c4.88944d","name":"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–æ–≥—Ä–µ–≤ –ª–æ–¥–∂–∏–∏","info":"","x":160,"y":20,"wires":[]},{"id":"a969674b.ca76b8","type":"server-state-changed","z":"16ff52c4.88944d","name":"–í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ –ø–æ–¥–æ–≥—Ä–µ–≤–∞","server":"6962e153.99eb9","version":1,"entityidfilter":"input_boolean.auto_temp_heater_switch_loggia","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":60,"wires":[["41442ad6.b2a134"]]},{"id":"148d7b89.062e74","type":"timerswitch","z":"16ff52c4.88944d","name":"07:00 & 23:00","ontopic":"","offtopic":"","onpayload":"time","offpayload":"time","disabled":false,"schedules":[{"on_h":"07","on_m":"00","on_s":"00","off_h":"23","off_m":"00","off_s":"00","valid":true}],"x":100,"y":140,"wires":[["41442ad6.b2a134"]]},{"id":"65304db2.42eeb4","type":"api-current-state","z":"16ff52c4.88944d","name":"–û–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.plug_158d00032d5e8b","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":660,"y":220,"wires":[["55812462.c8a30c"]]},{"id":"55812462.c8a30c","type":"change","z":"16ff52c4.88944d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"heater","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":220,"wires":[["5b7a751b.00ddec"]]},{"id":"35014ff1.ec50e","type":"comment","z":"8d422126.121a1","name":"Callback from messages","info":"","x":130,"y":1020,"wires":[]},{"id":"dc113e4d.bc0c8","type":"api-call-service","z":"8d422126.121a1","name":"Send telegram msg with actions","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_all","entityId":"","data":"{\"title\":\"*–£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å*\",\"message\":\"–í —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª–µ –æ—Å—Ç–∞–ª–æ—Å—å {{payload}}% –≤–æ–¥—ã. –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å?\",\"data\":{\"inline_keyboard\":[\"–í—ã–∫–ª—é—á–∏—Ç—å —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å:/humidifier_off\",\"–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –º–∏–Ω. —Ä–µ–∂–∏–º:/humidifier_low\",\"–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å:/none\"]}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":390,"y":180,"wires":[[]]},{"id":"516a7507.6b91cc","type":"switch","z":"8d422126.121a1","name":"–ö–æ–º–∞–Ω–¥—ã callback","property":"payload.event.data","propertyType":"msg","rules":[{"t":"eq","v":"/none","vt":"str"},{"t":"eq","v":"/humidifier_on","vt":"str"},{"t":"eq","v":"/humidifier_off","vt":"str"},{"t":"eq","v":"/humidifier_low","vt":"str"},{"t":"eq","v":"/heater_loggia_on","vt":"str"},{"t":"eq","v":"/heater_loggia_off","vt":"str"},{"t":"eq","v":"/heater_loggia_auto_on","vt":"str"},{"t":"eq","v":"/heater_loggia_auto_off","vt":"str"}],"checkall":"true","repair":false,"outputs":8,"x":390,"y":1060,"wires":[["ea6d8eef.c0934"],["70755256.5bb44c"],["483103d2.48834c"],["a4a9fac1.10a898"],["859ee6a7.57f3d8"],["12f712c5.3a9f0d"],["b7e08fd7.5c374"],["622a0a8e.3bd334"]]},{"id":"483103d2.48834c","type":"api-call-service","z":"8d422126.121a1","name":"–í—ã–∫–ª—é—á–∏—Ç—å —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å","server":"6962e153.99eb9","version":1,"service_domain":"fan","service":"turn_off","entityId":"fan.xiaomi_humidifier_bedroom","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":1000,"wires":[["8dda7e1e.8e8de"]]},{"id":"a4a9fac1.10a898","type":"api-call-service","z":"8d422126.121a1","name":"–£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å –Ω–∞ –º–∏–Ω–∏–º—É–º","server":"6962e153.99eb9","version":1,"service_domain":"fan","service":"set_speed","entityId":"fan.xiaomi_humidifier_bedroom","data":"{\"speed\":\"silent\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":1040,"wires":[["6ac8180a.4e9ed8"]]},{"id":"ae3b5f3b.86655","type":"ha-get-entities","z":"8d422126.121a1","server":"6962e153.99eb9","name":"Battery < 20","rules":[{"property":"attributes.battery_level","logic":"lt","value":"20","valueType":"num"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":310,"y":280,"wires":[["5772e39a.c019fc","5172a865.332878","598aecbf.bbbdb4"]]},{"id":"344237e8.5e14f8","type":"comment","z":"8d422126.121a1","name":"Battery Check","info":"","x":90,"y":240,"wires":[]},{"id":"5772e39a.c019fc","type":"debug","z":"8d422126.121a1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":530,"y":340,"wires":[]},{"id":"5172a865.332878","type":"debug","z":"8d422126.121a1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.attributes","targetType":"msg","x":560,"y":380,"wires":[]},{"id":"598aecbf.bbbdb4","type":"api-call-service","z":"8d422126.121a1","name":"Send telegram msg to All","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_all","entityId":"","data":"{\"title\":\"üîã *–ù–∏–∑–∫–∏–π –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ–π–∫–∏*\",\"message\":\"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ *{{payload.attributes.friendly_name}}* –∏–º–µ–µ—Ç –∑–∞—Ä—è–¥ *{{payload.attributes.battery_level}}%*.\\n –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å –±–∞—Ç–∞—Ä–µ–π–∫—É.\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":570,"y":280,"wires":[[]]},{"id":"412e5894.6b01e8","type":"ha-get-entities","z":"8d422126.121a1","server":"6962e153.99eb9","name":"Battery < 10","rules":[{"property":"attributes.battery_level","logic":"lt","value":"10","valueType":"num"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":310,"y":340,"wires":[["598aecbf.bbbdb4"]]},{"id":"48d2d4a1.a406bc","type":"inject","z":"8d422126.121a1","name":"Sat, Sun 13:00","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 13 * * 6,0","once":false,"onceDelay":0.1,"x":120,"y":280,"wires":[["ae3b5f3b.86655"]]},{"id":"bc72916b.5fc0d","type":"inject","z":"8d422126.121a1","name":"Every day 18:00","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 18 * * *","once":false,"onceDelay":0.1,"x":130,"y":340,"wires":[["412e5894.6b01e8"]]},{"id":"75be9a60.a2cfe4","type":"comment","z":"8d422126.121a1","name":"–£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å","info":"","x":90,"y":140,"wires":[]},{"id":"4f1333f9.45c10c","type":"inject","z":"6169ae85.ebde","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":480,"wires":[["fd6b1ff3.90d8b"]]},{"id":"fd6b1ff3.90d8b","type":"api-call-service","z":"6169ae85.ebde","name":"Send telegram msg to Pinkkoff","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_pinkkoff","entityId":"","data":"{\"title\":\"*–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ*\",\"message\":\"–≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –æ—Ç –£–º–Ω–æ–≥–æ –î–æ–º–∞.\\n –ö–ª–∞—Å—Å–Ω–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å?\",\"data\":{\"inline_keyboard\":[\"–í–æ–ª–æ–¥–µ—á–∫–∞ –º–æ–ª–æ–¥–µ—Ü:/command1, –ù—É —Ç–∞–∫–æ–µ...:/command2\"]}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":480,"wires":[[]]},{"id":"22551f21.387f3","type":"inject","z":"6169ae85.ebde","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":600,"wires":[["e11b567c.695718"]]},{"id":"e11b567c.695718","type":"api-call-service","z":"6169ae85.ebde","name":"Send telegram msg to All","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_all","entityId":"","data":"{\"title\":\"*–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ*\",\"message\":\"–≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –æ—Ç *–£–º–Ω–æ–≥–æ –î–æ–º–∞*.\\n –ö–ª–∞—Å—Å–Ω–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å?\",\"data\":{\"inline_keyboard\":[\"–í–æ–ª–æ–¥–µ—á–∫–∞ –º–æ–ª–æ–¥–µ—Ü:/command1, –ù—É —Ç–∞–∫–æ–µ...:/command2\"]}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":350,"y":600,"wires":[[]]},{"id":"2567e1cd.2e2a2e","type":"inject","z":"6169ae85.ebde","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":540,"wires":[["e5e13843.55fa48"]]},{"id":"e5e13843.55fa48","type":"api-call-service","z":"6169ae85.ebde","name":"Send telegram msg to Fludshorty","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_fludshorty","entityId":"","data":"{\"title\":\"*–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ*\",\"message\":\"–≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –æ—Ç *–£–º–Ω–æ–≥–æ –î–æ–º–∞*. –ö–ª–∞—Å—Å–Ω–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å?.\",\"data\":{\"inline_keyboard\":[\"–í–æ–ª–æ–¥–µ—á–∫–∞ –º–æ–ª–æ–¥–µ—Ü:/command1, –ù—É —Ç–∞–∫–æ–µ...:/command2\"]}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":380,"y":540,"wires":[[]]},{"id":"720c8765.a27098","type":"comment","z":"6169ae85.ebde","name":"–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–≥—Ä–∞–º —Å–æ–æ–±—â–µ–Ω–∏–π","info":"","x":150,"y":440,"wires":[]},{"id":"ee16f913.ca49a8","type":"ha-get-entities","z":"6169ae85.ebde","server":"6962e153.99eb9","name":"–í—Å–µ entities","rules":[{"property":"entity_id","logic":"does_not_include","value":"xiaomi","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":250,"y":700,"wires":[["57342609.2ef128"]]},{"id":"57342609.2ef128","type":"switch","z":"6169ae85.ebde","name":"–°—Ç–∞—Ç—É—Å—ã –±–∞—Ç–∞—Ä–µ–µ–∫","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"cont","v":"battery","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":700,"wires":[["9e21c24e.6861e"]]},{"id":"9e21c24e.6861e","type":"debug","z":"6169ae85.ebde","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.entity_id","targetType":"msg","x":640,"y":700,"wires":[]},{"id":"5da4912a.047ef","type":"inject","z":"6169ae85.ebde","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":700,"wires":[["ee16f913.ca49a8"]]},{"id":"d34d9c21.be0f8","type":"comment","z":"6169ae85.ebde","name":"–§–∏–ª—å—Ç—Ä –±–∞—Ç–∞—Ä–µ–µ–∫","info":"","x":100,"y":660,"wires":[]},{"id":"d9ac1cfa.d84a6","type":"comment","z":"8d422126.121a1","name":"Smoke Sensor","info":"","x":100,"y":460,"wires":[]},{"id":"856d8bce.bb9288","type":"comment","z":"8d422126.121a1","name":"Leak Sensor","info":"","x":90,"y":620,"wires":[]},{"id":"eaf438bc.2cdac8","type":"server-state-changed","z":"8d422126.121a1","name":"Smoke sensor ON","server":"6962e153.99eb9","version":1,"entityidfilter":"binary_sensor.xiaomi_smoke_kitchen_158d00028229a1","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":500,"wires":[["91b315b1.7003e8"],[]]},{"id":"2e1e95f6.5bf28a","type":"api-call-service","z":"8d422126.121a1","name":"Send telegram msg to All","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_pinkkoff","entityId":"","data":"{\"title\":\"‚ùóÔ∏è*–û–ü–ê–°–ù–û–°–¢–¨‚ùóÔ∏è –í–æ–∑–º–æ–∂–µ–Ω –ø–æ–∂–∞—Ä –Ω–∞ –∫—É—Ö–Ω–µ*üî•\",\"message\":\"–£—Ä–æ–≤–µ–Ω—å –∑–∞–¥—ã–º–ª–µ–Ω–∏—è: {{data.attributes.Density}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":610,"y":460,"wires":[[]]},{"id":"672d7f48.28336","type":"api-call-service","z":"8d422126.121a1","name":"Send sound push to all","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"ios_iphone_pinkkoff","entityId":"","data":"{\"message\":\"–£—Ä–æ–≤–µ–Ω—å –∑–∞–¥—ã–º–ª–µ–Ω–∏—è:{{data.attributes.Density}} \",\"title\":\"‚ùó–û–ü–ê–°–ù–û–°–¢–¨‚ùóÔ∏è –í–æ–∑–º–æ–∂–µ–Ω –ø–æ–∂–∞—Ä –Ω–∞ –∫—É—Ö–Ω–µüî•\",\"data\":{\"push\":{\"sound\":\"US-EN-Alexa-Smoke-Detected-Generic.wav\"}}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":600,"y":500,"wires":[[]]},{"id":"91b315b1.7003e8","type":"api-current-state","z":"8d422126.121a1","name":"–ó–∞–¥—ã–º–ª–µ–Ω–Ω–æ—Å—Ç—å","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.xiaomi_smoke_kitchen_158d00028229a1","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":330,"y":500,"wires":[["27cdffa3.800e7","2e1e95f6.5bf28a","672d7f48.28336","a150322e.bbb5e"]]},{"id":"27cdffa3.800e7","type":"debug","z":"8d422126.121a1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":540,"wires":[]},{"id":"a150322e.bbb5e","type":"debug","z":"8d422126.121a1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","x":600,"y":540,"wires":[]},{"id":"fc17f3f1.d59ad","type":"server-state-changed","z":"8d422126.121a1","name":"Leak sensor ON","server":"6962e153.99eb9","version":1,"entityidfilter":"binary_sensor.xiaomi_water_leak_bedroom_158d00027b0cd4","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":100,"y":660,"wires":[["ddfcfe38.1b09c","dae259f6.37a788"],[]]},{"id":"ddfcfe38.1b09c","type":"api-call-service","z":"8d422126.121a1","name":"Send telegram msg to All","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_all","entityId":"","data":"{\"title\":\"‚ùó*–û–ü–ê–°–ù–û–°–¢–¨‚ùóÔ∏è–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ—Ç–µ—á–∫–∞*üíß\",\"message\":\"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {{data.new_state.attributes.friendly_name}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":640,"wires":[[]]},{"id":"dae259f6.37a788","type":"api-call-service","z":"8d422126.121a1","name":"Send sound push to All","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"ios_iphone_pinkkoff","entityId":"","data":"{\"title\":\"‚ùó–û–ü–ê–°–ù–û–°–¢–¨‚ùóÔ∏è–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ—Ç–µ—á–∫–∞üíß\",\"message\":\"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {{data.new_state.attributes.friendly_name}}\",\"data\":{\"push\":{\"sound\":\"US-EN-Alexa-Water-Detected-Generic.wav\"}}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":360,"y":680,"wires":[[]]},{"id":"3fc90600.0ce39a","type":"comment","z":"8d422126.121a1","name":"Device availability","info":"","x":110,"y":40,"wires":[]},{"id":"d603d959.56b778","type":"api-call-service","z":"8d422126.121a1","name":"Send telegram msg to All","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_all","entityId":"","data":"{\"title\":\"‚ö†Ô∏è*–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ HA*\",\"message\":\"–ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: *{{data.new_state.attributes.friendly_name}}*\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":430,"y":80,"wires":[[]]},{"id":"d834a6e3.7c6148","type":"server-state-changed","z":"8d422126.121a1","name":"State change to unavailable ","server":"6962e153.99eb9","version":1,"entityidfilter":".*","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"unavailable","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":140,"y":80,"wires":[["d603d959.56b778"],[]]},{"id":"bed7d097.e595f","type":"api-call-service","z":"ee1a9216.12937","name":"Send telegram msg to All","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_pinkkoff","entityId":"","data":"{\"title\":\"{{title}}\",\"message\":\"{{message}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":810,"y":400,"wires":[[]]},{"id":"1d8cb28.283664e","type":"server-state-changed","z":"ee1a9216.12937","name":"state temp bedroom","server":"6962e153.99eb9","version":1,"entityidfilter":"sensor.xiaomi_thp_temperature_bedroom_158d00025f03f5","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":380,"wires":[["d12caefb.6b83e"]]},{"id":"66881ac0.cd6f64","type":"switch","z":"7cf1202f.0fec5","name":"<low-high<","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"high","vt":"env"},{"t":"btwn","v":"low","vt":"env","v2":"high","v2t":"env"},{"t":"lt","v":"low","vt":"env"}],"checkall":"true","repair":false,"outputs":3,"x":390,"y":140,"wires":[["5a8930d.d27e7d"],["bd08a965.f10ce8"],["5aec55b.90952ac"]]},{"id":"bd08a965.f10ce8","type":"change","z":"7cf1202f.0fec5","name":"Normal","rules":[{"t":"move","p":"payload","pt":"msg","to":"value","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"normal","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":140,"wires":[["b50f5b7b.baa748"]]},{"id":"5a8930d.d27e7d","type":"change","z":"7cf1202f.0fec5","name":"High","rules":[{"t":"move","p":"payload","pt":"msg","to":"value","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"high","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":100,"wires":[["b50f5b7b.baa748"]]},{"id":"5aec55b.90952ac","type":"change","z":"7cf1202f.0fec5","name":"Low","rules":[{"t":"move","p":"payload","pt":"msg","to":"value","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"low","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":180,"wires":[["b50f5b7b.baa748"]]},{"id":"b50f5b7b.baa748","type":"rbe","z":"7cf1202f.0fec5","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":770,"y":140,"wires":[[]]},{"id":"3e4d5ddc.0c2b52","type":"function","z":"ee1a9216.12937","name":"msg temp","func":"// inputs var\nvar device_name = msg.data.new_state.attributes.friendly_name;\nvar curr_temp = msg.value;\nvar status = msg.payload;\n\n// –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–∫–æ–Ω–∫–∏\n// ü•µ ü•∂ üôÇ ‚òÄÔ∏è‚ùÑÔ∏èüëç\n\nif (status == \"high\") {\n    msg.title=\"ü•µ *–°—Ç–∞–ª–æ —Å–ª–∏—à–∫–æ–º –∂–∞—Ä–∫–æ!*\"\n} else if (status == \"normal\") {\n    msg.title=\"üôÇ *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –≤ –Ω–æ—Ä–º—É.*\"\n} else if (status == \"low\") {\n    msg.title=\"ü•∂ *–°—Ç–∞–ª–æ —Å–ª–∏—à–∫–æ–º —Ö–æ–ª–æ–¥–Ω–æ!*\"\n} else {\n    msg.title=\"*–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å flow –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ.*\"\n}\n\nmsg.message = \"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: *\" +  device_name + \"*.\\\\n \" +\n            \"–¢–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: *\" + curr_temp + \"¬∞C*.\"; \n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":400,"wires":[["d56c309f.246d6","bed7d097.e595f"]]},{"id":"d56c309f.246d6","type":"debug","z":"ee1a9216.12937","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":360,"wires":[]},{"id":"21957332.b027ec","type":"server-state-changed","z":"ee1a9216.12937","name":"state temp bathroom","server":"6962e153.99eb9","version":1,"entityidfilter":"sensor.xiaomi_thp_temperature_bathroom_158d00025f14c5","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":420,"wires":[["d12caefb.6b83e"]]},{"id":"45ac5ca1.2c8604","type":"server-state-changed","z":"ee1a9216.12937","name":"state temp loggia","server":"6962e153.99eb9","version":1,"entityidfilter":"sensor.xiaomi_thp_temperature_loggia_158d0002389f84","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":100,"y":520,"wires":[["d5de7cd9.7d984"]]},{"id":"d12caefb.6b83e","type":"subflow:7cf1202f.0fec5","z":"ee1a9216.12937","name":"< 20 - 26 <","env":[{"name":"low","type":"num","value":"20"},{"name":"high","type":"num","value":"26"},{"name":"hysteresis","type":"str","value":"0.2"}],"x":310,"y":400,"wires":[["3e4d5ddc.0c2b52"]]},{"id":"d5de7cd9.7d984","type":"subflow:7cf1202f.0fec5","z":"ee1a9216.12937","name":"< 2 - 35 <","env":[{"name":"low","type":"num","value":"2"},{"name":"high","type":"num","value":"35"},{"name":"hysteresis","type":"str","value":"0.2"}],"x":300,"y":520,"wires":[["4485c54f.d66a3c"]]},{"id":"ce22e49d.c8af48","type":"function","z":"ee1a9216.12937","name":"msg temp loggia","func":"// inputs var\nvar device_name = msg.data.new_state.attributes.friendly_name;\nvar curr_temp = msg.value;\nvar status = msg.payload;\nvar heater = msg.heater;\nvar auto = msg.auto;\n\n// –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–∫–æ–Ω–∫–∏\n// ü•µ ü•∂ üôÇ ‚òÄÔ∏è‚ùÑÔ∏èüëç\n\nif (status == \"high\") {\n    msg.title=\"ü•µ *–°—Ç–∞–ª–æ —Å–ª–∏—à–∫–æ–º –∂–∞—Ä–∫–æ!*\"\n} else if (status == \"normal\") {\n    msg.title=\"üôÇ *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –≤ –Ω–æ—Ä–º—É.*\"\n} else if (status == \"low\") {\n    msg.title=\"ü•∂ *–°—Ç–∞–ª–æ —Å–ª–∏—à–∫–æ–º —Ö–æ–ª–æ–¥–Ω–æ!*\"\n} else {\n    msg.title=\"*–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å flow –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ.*\"\n}\n\nheater = (heater) ? \"*–í–∫–ª—é—á–µ–Ω*\" : \"*–í—ã–∫–ª—é—á–µ–Ω*\";\nauto = (auto) ? \"*–í–∫–ª—é—á–µ–Ω*\" : \"*–í—ã–∫–ª—é—á–µ–Ω*\";\n\nmsg.message =   \"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: *\" +  device_name + \n                \"*.\\\\n\" + \"–¢–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: *\" +\n                curr_temp + \"¬∞C*.\" + \"\\\\n\" +\n                \"–û–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å: \" + heater + \".\\\\n\" +\n                \"–ê–≤—Ç–æ –æ–±–æ—Ä–≥–µ–≤: \" + auto + \".\";\n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":560,"wires":[["d0d30fd4.42a54","e0e4a087.dfc7d"]]},{"id":"d0d30fd4.42a54","type":"api-call-service","z":"ee1a9216.12937","name":"Send telegram msg with actions","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_pinkkoff","entityId":"","data":"{\"title\":\"{{title}}\",\"message\":\"{{message}}\",\"data\":{\"inline_keyboard\":[\"–í–∫–ª –æ–±–æ–≥—Ä–µ–≤:/heater_loggia_on, –í—ã–∫–ª –æ–±–æ–≥—Ä–µ–≤:/heater_loggia_off\",\"–í–∫–ª –∞–≤—Ç–æ –æ–±–æ–≥—Ä–µ–≤:/heater_loggia_auto_on, –í—ã–∫–ª –∞–≤—Ç–æ –æ–±–æ–≥—Ä–µ–≤:/heater_loggia_auto_off\",\"–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å:/none\"]}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":830,"y":520,"wires":[[]]},{"id":"a5966c71.298fc","type":"server-state-changed","z":"ee1a9216.12937","name":"state input_n_2","server":"6962e153.99eb9","version":1,"entityidfilter":"input_number.test_input_number_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":500,"y":60,"wires":[[]]},{"id":"e0e4a087.dfc7d","type":"debug","z":"ee1a9216.12937","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":480,"wires":[]},{"id":"4485c54f.d66a3c","type":"api-current-state","z":"ee1a9216.12937","name":"heater loggia","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.plug_158d00032d5e8b","state_type":"habool","state_location":"heater","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":530,"y":480,"wires":[["8487d1c3.c4329"]]},{"id":"8487d1c3.c4329","type":"api-current-state","z":"ee1a9216.12937","name":"auto heater loggia","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.auto_temp_heater_switch_loggia","state_type":"habool","state_location":"auto","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":530,"y":520,"wires":[["ce22e49d.c8af48"]]},{"id":"3ddff657.02ffba","type":"server-state-changed","z":"ee1a9216.12937","name":"state hum bathroom","server":"6962e153.99eb9","version":1,"entityidfilter":"sensor.xiaomi_thp_humidity_bathroom_158d00025f14c5","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":680,"wires":[["76525d0.91653a4"]]},{"id":"ff2423b9.28c0a","type":"server-state-changed","z":"ee1a9216.12937","name":"state hum bedroom","server":"6962e153.99eb9","version":1,"entityidfilter":"sensor.xiaomi_thp_humidity_bedroom_158d00025f03f5","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":640,"wires":[["76525d0.91653a4"]]},{"id":"76525d0.91653a4","type":"subflow:7cf1202f.0fec5","z":"ee1a9216.12937","name":"< 30 - 80 <","env":[{"name":"low","type":"num","value":"30"},{"name":"high","type":"num","value":"80"},{"name":"hysteresis","type":"str","value":"3"}],"x":310,"y":660,"wires":[["ab9fd9bd.313dd8"]]},{"id":"a151e3f6.792dd","type":"function","z":"ee1a9216.12937","name":"msg hum","func":"// inputs var\nvar device_name = msg.data.new_state.attributes.friendly_name;\nvar curr_hum = msg.value;\nvar status = msg.payload;\nvar humidifier = msg.humidifier\nvar water_level = msg.water_level\n\n// –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–∫–æ–Ω–∫–∏\n// ü•µ ü•∂ üôÇ ‚òÄÔ∏è‚ùÑÔ∏èüëç üíß ‚ö†Ô∏è\n\nif (status == \"high\") {\n    msg.title=\"üíß *C–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å!*\"\n} else if (status == \"normal\") {\n    msg.title=\"üëç *–í–ª–∞–∂–Ω–æ—Å—Ç—å –≤–µ—Ä–Ω—É–ª–∞—Å—å –≤ –Ω–æ—Ä–º—É.*\"\n} else if (status == \"low\") {\n    msg.title=\"‚ö†Ô∏è*–ù–∏–∑–∫–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å!*\"\n} else {\n    msg.title=\"*–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å flow –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ.*\"\n}\n\nhumidifier = (humidifier) ? \"*–í–∫–ª—é—á–µ–Ω*\" : \"*–í—ã–∫–ª—é—á–µ–Ω*\";\n\nmsg.message =   \"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: *\" +  device_name + \"*.\\\\n\" + \n                \"–¢–µ–∫—É—â–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å: *\" + curr_hum + \"%*.\\\\n\" +\n                \"–£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å: \" + humidifier + \".\\\\n\" +\n                \"–£—Ä–æ–≤–µ–Ω—å –≤–æ–¥—ã: *\" + water_level + \"%*.\"; \n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":700,"wires":[["514db213.bfb7bc","5c68c2cd.534c2c"]]},{"id":"ab9fd9bd.313dd8","type":"api-current-state","z":"ee1a9216.12937","name":"humidifier","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"fan.xiaomi_humidifier_bedroom","state_type":"habool","state_location":"humidifier","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":540,"y":620,"wires":[["3853ae46.fd5f22"]]},{"id":"514db213.bfb7bc","type":"api-call-service","z":"ee1a9216.12937","name":"Send telegram msg with actions","server":"6962e153.99eb9","version":1,"service_domain":"notify","service":"telegram_ha_pinkkoff","entityId":"","data":"{\"title\":\"{{title}}\",\"message\":\"{{message}}\",\"data\":{\"inline_keyboard\":[\"–í–∫–ª —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å:/humidifier_on, –í—ã–∫–ª —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å:/humidifier_off\",\"–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å:/none\"]}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":830,"y":660,"wires":[[]]},{"id":"646e9d5b.bce804","type":"comment","z":"ee1a9216.12937","name":"===================  –û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –≤—ã—Ö–æ–¥–µ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã  ===================","info":"","x":580,"y":300,"wires":[]},{"id":"d240ef41.633b4","type":"comment","z":"ee1a9216.12937","name":"Temperature bath and bedroom","info":"","x":150,"y":340,"wires":[]},{"id":"dbeb1ebd.08814","type":"comment","z":"ee1a9216.12937","name":"Temperature loggia with action","info":"","x":140,"y":480,"wires":[]},{"id":"31dff6a8.1c347a","type":"comment","z":"ee1a9216.12937","name":"Humidity bath and bedroom with action","info":"","x":170,"y":600,"wires":[]},{"id":"3853ae46.fd5f22","type":"api-current-state","z":"ee1a9216.12937","name":"water level","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.xiaomi_humidifier_bedroom_water_level","state_type":"num","state_location":"water_level","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":530,"y":660,"wires":[["a151e3f6.792dd"]]},{"id":"d737cfdc.c452d","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"5","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":900,"wires":[["4ac43015.b7145"]]},{"id":"62493dd0.c1ae44","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"6","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":1060,"wires":[["4ac43015.b7145"]]},{"id":"6f75fb78.639a04","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"5.2","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":940,"wires":[["4ac43015.b7145"]]},{"id":"4d9deec5.86956","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"4.9","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":860,"wires":[["4ac43015.b7145"]]},{"id":"4ac43015.b7145","type":"subflow:7cf1202f.0fec5","z":"ee1a9216.12937","name":"","env":[{"name":"low","type":"num","value":"5"},{"name":"high","type":"num","value":"6"},{"name":"hysteresis","type":"str","value":"0.2"}],"x":490,"y":940,"wires":[["3572c9c6.146946","5f07d9f1.195c08"]]},{"id":"724a9aa9.7153d4","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"6.1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":1100,"wires":[["4ac43015.b7145"]]},{"id":"3572c9c6.146946","type":"debug","z":"ee1a9216.12937","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":900,"wires":[]},{"id":"5f07d9f1.195c08","type":"debug","z":"ee1a9216.12937","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":940,"wires":[]},{"id":"5c68c2cd.534c2c","type":"debug","z":"ee1a9216.12937","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":620,"wires":[]},{"id":"8f62e8fc.ca77f8","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"5.3","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":980,"wires":[["4ac43015.b7145"]]},{"id":"c42eb8ae.0deee8","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"5.4","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":1020,"wires":[["4ac43015.b7145"]]},{"id":"6b4dd9c9.6c54f8","type":"rbe","z":"7cf1202f.0fec5","name":"Hysteresis","func":"deadbandEq","gap":"$(hysteresis)","start":"","inout":"out","property":"payload","x":200,"y":140,"wires":[["66881ac0.cd6f64"]]},{"id":"326866ef.f5eb6a","type":"inject","z":"ee1a9216.12937","name":"","topic":"","payload":"4.8","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":820,"wires":[["4ac43015.b7145"]]},{"id":"50c100a7.ade78","type":"comment","z":"8d422126.121a1","name":"===================  Telegram Callback Actions  ===================","info":"","x":550,"y":780,"wires":[]},{"id":"70755256.5bb44c","type":"api-call-service","z":"8d422126.121a1","name":"–í–∫–ª—é—á–∏—Ç—å —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å","server":"6962e153.99eb9","version":1,"service_domain":"fan","service":"turn_on","entityId":"fan.xiaomi_humidifier_bedroom","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":960,"wires":[["8dda7e1e.8e8de"]]},{"id":"6b7e38ed.d10518","type":"api-call-service","z":"8d422126.121a1","name":"Reply telegram msg","server":"6962e153.99eb9","version":1,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"title\":\"*–û—Ç—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã*\",\"message\":\"–°—Ç–∞—Ç—É—Å —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—è: {{humidifier}}\",\"target\":\"{{payload.event.message.chat.id}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1160,"y":980,"wires":[[]]},{"id":"8dda7e1e.8e8de","type":"api-current-state","z":"8d422126.121a1","name":"humidifier","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"fan.xiaomi_humidifier_bedroom","state_type":"str","state_location":"humidifier","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":900,"y":980,"wires":[["6b7e38ed.d10518"]]},{"id":"6ac8180a.4e9ed8","type":"api-current-state","z":"8d422126.121a1","name":"humidifier_speed","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.xiaomi_humidifier_bedroom_mode","state_type":"str","state_location":"humidifier","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":930,"y":1040,"wires":[["db2e9a75.dd2438"]]},{"id":"db2e9a75.dd2438","type":"api-call-service","z":"8d422126.121a1","name":"Reply telegram msg","server":"6962e153.99eb9","version":1,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"title\":\"*–û—Ç—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã*\",\"message\":\"–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—è: {{humidifier}}\",\"target\":\"{{payload.event.message.chat.id}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1160,"y":1040,"wires":[[]]},{"id":"ea6d8eef.c0934","type":"api-call-service","z":"8d422126.121a1","name":"None - Reply telegram msg","server":"6962e153.99eb9","version":1,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"message\":\"–î–µ–π—Å—Ç–≤–∏–π –Ω–µ –≤—ã–±—Ä–∞–Ω–æ.\",\"target\":\"{{payload.event.message.chat.id}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":920,"wires":[[]]},{"id":"859ee6a7.57f3d8","type":"api-call-service","z":"8d422126.121a1","name":"Heater loggia ON","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":650,"y":1080,"wires":[["cbd08832.b71a58"]]},{"id":"12f712c5.3a9f0d","type":"api-call-service","z":"8d422126.121a1","name":"Heater loggia OFF","server":"6962e153.99eb9","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.plug_158d00032d5e8b","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":650,"y":1120,"wires":[["cbd08832.b71a58"]]},{"id":"b7e08fd7.5c374","type":"api-call-service","z":"8d422126.121a1","name":"Auto heat loggia ON","server":"6962e153.99eb9","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.auto_temp_heater_switch_loggia","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":660,"y":1160,"wires":[["cbd08832.b71a58"]]},{"id":"622a0a8e.3bd334","type":"api-call-service","z":"8d422126.121a1","name":"Auto heat loggia OFF","server":"6962e153.99eb9","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.auto_temp_heater_switch_loggia","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":660,"y":1200,"wires":[["cbd08832.b71a58"]]},{"id":"cbd08832.b71a58","type":"api-current-state","z":"8d422126.121a1","name":"Heater","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.plug_158d00032d5e8b","state_type":"str","state_location":"heater","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":870,"y":1140,"wires":[["926f712f.6dbc6"]]},{"id":"926f712f.6dbc6","type":"api-current-state","z":"8d422126.121a1","name":"Auto heat loggia","server":"6962e153.99eb9","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.auto_temp_heater_switch_loggia","state_type":"str","state_location":"auto_heat","override_payload":"msg","entity_location":"","override_data":"none","blockInputOverrides":false,"x":1020,"y":1140,"wires":[["6167f616.d3b928"]]},{"id":"6167f616.d3b928","type":"api-call-service","z":"8d422126.121a1","name":"Reply telegram msg","server":"6962e153.99eb9","version":1,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"title\":\"*–û—Ç—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã*\",\"message\":\"–°—Ç–∞—Ç—É—Å –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—è: *{{heater}}* \\n–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø–æ–¥–æ–≥—Ä–µ–≤–∞: *{{auto_heat}}*.\",\"target\":\"{{payload.event.message.chat.id}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1220,"y":1140,"wires":[[]]},{"id":"a370a665.21b378","type":"switch","z":"8d422126.121a1","name":"","property":"payload.event.command","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"eq","v":"/help","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":1380,"wires":[[],[]]},{"id":"c50f6ecd.567a4","type":"comment","z":"8d422126.121a1","name":"/start & /help","info":"","x":390,"y":1340,"wires":[]}]