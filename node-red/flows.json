[
    {
        "id": "6169ae85.ebde",
        "type": "tab",
        "label": "Примеры",
        "disabled": true,
        "info": ""
    },
    {
        "id": "6a24dcbb.10a694",
        "type": "tab",
        "label": "Освещение",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8d422126.121a1",
        "type": "tab",
        "label": "Оповещения",
        "disabled": false,
        "info": ""
    },
    {
        "id": "16ff52c4.88944d",
        "type": "tab",
        "label": "Климат",
        "disabled": false,
        "info": ""
    },
    {
        "id": "96899f2.417176",
        "type": "tab",
        "label": "Telegram bot",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ee1a9216.12937",
        "type": "tab",
        "label": "Тест",
        "disabled": false,
        "info": ""
    },
    {
        "id": "7cf1202f.0fec5",
        "type": "subflow",
        "name": "2-T-trigger",
        "info": "# Назначение\n2-T-Trigger генерирует сообщение, когда значение input пересекает один из трешхолдов.\n# Input\nПринимает числовые значения msg.payload, которые потом сравнивает с трешхолдами\n# Parameters\n**low** - нижняя граница\n\n**high** - верхняя граница\n\n**hysteresis** - гистерезис. Позволяет блокировать колебания значения. Нода блокирует изменения, если текущее значение изменилось менее, чем на величину гистерезиса относительно последнего незаблокированного значения. \n\n# Output\n * Текущий msg.payload помещает в msg.value\n * Заменяет msg.payload на:\n    * **low** - при снижении значения ниже low\n    * **high** - при повышении значения выше high\n    * **normal** - при возвращении значения между low и high",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 140,
                "wires": [
                    {
                        "id": "6b4dd9c9.6c54f8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 880,
                "y": 140,
                "wires": [
                    {
                        "id": "b50f5b7b.baa748",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "low",
                "type": "num",
                "value": ""
            },
            {
                "name": "high",
                "type": "num",
                "value": ""
            },
            {
                "name": "hysteresis",
                "type": "str",
                "value": "0"
            }
        ],
        "icon": "node-red-contrib-home-assistant-websocket/trigger.png"
    },
    {
        "id": "6962e153.99eb9",
        "type": "server",
        "z": "",
        "name": "Home Assistant"
    },
    {
        "id": "ac5fa68f.43b8d8",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "12c41a6a.f1de76",
        "type": "server-state-changed",
        "z": "6a24dcbb.10a694",
        "d": true,
        "name": "Движение в ванной",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.xiaomi_motion_bathroom_158d0002b6e8e6",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 100,
        "wires": [
            [
                "fecba39c.3a198"
            ],
            []
        ]
    },
    {
        "id": "b6033392.b4a27",
        "type": "trigger",
        "z": "6a24dcbb.10a694",
        "op1": "",
        "op2": "off",
        "op1type": "nul",
        "op2type": "str",
        "duration": "5",
        "extend": true,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "name": "Выключение 5 минут",
        "x": 1060,
        "y": 80,
        "wires": [
            [
                "32aef640.2ec2fa",
                "61c91bef.adffb4"
            ]
        ]
    },
    {
        "id": "fecba39c.3a198",
        "type": "api-current-state",
        "z": "6a24dcbb.10a694",
        "name": "Режим авто включен?",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.auto_light_bedroom_switch",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 340,
        "y": 100,
        "wires": [
            [
                "80c4d1f9.db6f9"
            ],
            []
        ]
    },
    {
        "id": "80c4d1f9.db6f9",
        "type": "api-current-state",
        "z": "6a24dcbb.10a694",
        "name": "Свет включен?",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.gateway_light_7c49eb1babbf",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 560,
        "y": 100,
        "wires": [
            [
                "a35bf8a1.61f748"
            ],
            [
                "190ed18e.6376ee"
            ]
        ]
    },
    {
        "id": "a35bf8a1.61f748",
        "type": "switch",
        "z": "6a24dcbb.10a694",
        "name": "Автоматизация?",
        "property": "my_auto",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 770,
        "y": 60,
        "wires": [
            [
                "b6033392.b4a27"
            ]
        ]
    },
    {
        "id": "dc42f363.01c3",
        "type": "change",
        "z": "6a24dcbb.10a694",
        "name": "Старт автоматизации ",
        "rules": [
            {
                "t": "set",
                "p": "my_auto",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 140,
        "wires": [
            [
                "20483881.10cf38"
            ]
        ]
    },
    {
        "id": "32aef640.2ec2fa",
        "type": "change",
        "z": "6a24dcbb.10a694",
        "name": "Стоп автоматизация",
        "rules": [
            {
                "t": "set",
                "p": "my_auto",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1340,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "20483881.10cf38",
        "type": "api-call-service",
        "z": "6a24dcbb.10a694",
        "name": "Включить свет",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.gateway_light_7c49eb1babbf",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1160,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "61c91bef.adffb4",
        "type": "api-call-service",
        "z": "6a24dcbb.10a694",
        "name": "Выключить свет",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "light.gateway_light_7c49eb1babbf",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1330,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "190ed18e.6376ee",
        "type": "api-current-state",
        "z": "6a24dcbb.10a694",
        "name": "< 50 lx",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "50",
        "halt_if_type": "num",
        "halt_if_compare": "lt",
        "override_topic": false,
        "entity_id": "sensor.xiaomi_illumin_bathroom_158d0002b6e8e6",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 730,
        "y": 140,
        "wires": [
            [
                "b6033392.b4a27",
                "dc42f363.01c3"
            ],
            []
        ]
    },
    {
        "id": "88084487.2a71c8",
        "type": "comment",
        "z": "6a24dcbb.10a694",
        "name": "===================  Подсветка в ванной  ===================",
        "info": "",
        "x": 590,
        "y": 20,
        "wires": []
    },
    {
        "id": "83ce2c07.fbaa3",
        "type": "server-events",
        "z": "6a24dcbb.10a694",
        "name": "",
        "server": "6962e153.99eb9",
        "event_type": "",
        "x": 80,
        "y": 520,
        "wires": [
            [
                "1079ba9.3aa4d45",
                "43b2920d.b57dbc"
            ]
        ]
    },
    {
        "id": "1079ba9.3aa4d45",
        "type": "switch",
        "z": "6a24dcbb.10a694",
        "name": "Кнопка на выходе",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "binary_sensor.xiaomi_exit_switch_lobby_158d0002135c59",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 310,
        "y": 500,
        "wires": [
            [
                "2a8182fb.79f1de"
            ]
        ]
    },
    {
        "id": "2a8182fb.79f1de",
        "type": "switch",
        "z": "6a24dcbb.10a694",
        "name": "Тип нажатия",
        "property": "payload.event.click_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "single",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "double",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "long_click_press",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 510,
        "y": 500,
        "wires": [
            [
                "222f95a8.b270ea"
            ],
            [],
            []
        ]
    },
    {
        "id": "43b2920d.b57dbc",
        "type": "switch",
        "z": "6a24dcbb.10a694",
        "name": "Выключатель на шкафу",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "binary_sensor.xiaomi_wall_switch_bedroom_158d000230d4a2",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 330,
        "y": 380,
        "wires": [
            [
                "90ab1a30.408168"
            ]
        ]
    },
    {
        "id": "90ab1a30.408168",
        "type": "api-call-service",
        "z": "6a24dcbb.10a694",
        "name": "Включить ночник",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "switch",
        "service": "toggle",
        "entityId": "switch.plug_158d0002677bd3",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 590,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "618e821.e9bd37c",
        "type": "comment",
        "z": "6a24dcbb.10a694",
        "name": "===================  Реагирование на события  ===================  ",
        "info": "",
        "x": 590,
        "y": 340,
        "wires": []
    },
    {
        "id": "a1145bd3.bfae58",
        "type": "api-call-service",
        "z": "6169ae85.ebde",
        "name": "Отправить push",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "ios_iphone_all",
        "entityId": "",
        "data": "{\"message\":\"Тестовая нотификация\",\"title\":\"Заголовок Push\",\"data\":{\"subtitle\":\"Подзаголовок\",\"push\":{\"thread-id\":\"example-notification-group\",\"badge\":\"0\"}}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 290,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "fe8a5729.082a78",
        "type": "inject",
        "z": "6169ae85.ebde",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 80,
        "wires": [
            [
                "a1145bd3.bfae58"
            ]
        ]
    },
    {
        "id": "6882506e.d0647",
        "type": "api-call-service",
        "z": "6169ae85.ebde",
        "name": "Отправить динам. push",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "ios_iphone_all",
        "entityId": "",
        "data": "{\"message\":\"{{payload}}\",\"title\":\"Динамический PUSH с действием\",\"data\":{\"subtitle\":\"Подзаголовок\",\"push\":{\"thread-id\":\"example-notification-group\",\"badge\":\"0\"}}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "1dd13918.951957",
        "type": "inject",
        "z": "6169ae85.ebde",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 180,
        "wires": [
            [
                "6882506e.d0647"
            ]
        ]
    },
    {
        "id": "f045470a.3be468",
        "type": "comment",
        "z": "6169ae85.ebde",
        "name": "Push с динамическим сообщением",
        "info": "",
        "x": 160,
        "y": 140,
        "wires": []
    },
    {
        "id": "50773b7c.75efe4",
        "type": "api-call-service",
        "z": "6169ae85.ebde",
        "name": "Отправить динам. push с action",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "ios_iphone_all",
        "entityId": "",
        "data": "{\"message\":\"{{payload}}\",\"title\":\"Динамический PUSH с действием\",\"data\":{\"subtitle\":\"Нажми на меня\",\"push\":{\"category\":\"test\",\"thread-id\":\"example-notification-group\",\"badge\":\"0\"}}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 340,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "13527367.ad6bbd",
        "type": "inject",
        "z": "6169ae85.ebde",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 280,
        "wires": [
            [
                "50773b7c.75efe4"
            ]
        ]
    },
    {
        "id": "991c69b4.d8e408",
        "type": "comment",
        "z": "6169ae85.ebde",
        "name": "Push с динамическим сообщением и действием!",
        "info": "",
        "x": 210,
        "y": 240,
        "wires": []
    },
    {
        "id": "5710f1bf.20b96",
        "type": "comment",
        "z": "6169ae85.ebde",
        "name": "Push с обычным сообщением",
        "info": "",
        "x": 150,
        "y": 40,
        "wires": []
    },
    {
        "id": "92afee7d.b04e1",
        "type": "debug",
        "z": "ee1a9216.12937",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 410,
        "y": 140,
        "wires": []
    },
    {
        "id": "8a7dddc6.196c4",
        "type": "trigger-state",
        "z": "8d422126.121a1",
        "name": "Вода в баке < 25%",
        "server": "6962e153.99eb9",
        "entityid": "sensor.xiaomi_humidifier_bedroom_water_level",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "rf8soktow1",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "<",
                "comparatorValueDatatype": "num",
                "comparatorValue": "25"
            },
            {
                "id": "6ehtgtm70z6",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "previous_state",
                "propertyValue": "old_state.state",
                "comparatorType": ">=",
                "comparatorValueDatatype": "num",
                "comparatorValue": "25"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "num",
        "x": 110,
        "y": 1400,
        "wires": [
            [
                "dc113e4d.bc0c8"
            ],
            []
        ]
    },
    {
        "id": "7c1c29ec.41c5d8",
        "type": "server-events",
        "z": "ee1a9216.12937",
        "name": "",
        "server": "6962e153.99eb9",
        "event_type": "telegram_callback",
        "x": 130,
        "y": 80,
        "wires": [
            [
                "92afee7d.b04e1"
            ]
        ]
    },
    {
        "id": "c377506d.8d0e4",
        "type": "server-events",
        "z": "ee1a9216.12937",
        "name": "",
        "server": "6962e153.99eb9",
        "event_type": "telegram_text",
        "x": 120,
        "y": 140,
        "wires": [
            [
                "92afee7d.b04e1"
            ]
        ]
    },
    {
        "id": "9dcf9d63.a4ec7",
        "type": "server-events",
        "z": "ee1a9216.12937",
        "name": "",
        "server": "6962e153.99eb9",
        "event_type": "telegram_command",
        "x": 140,
        "y": 200,
        "wires": [
            [
                "92afee7d.b04e1"
            ]
        ]
    },
    {
        "id": "817d4e5d.95921",
        "type": "comment",
        "z": "ee1a9216.12937",
        "name": "Прослушка телеграм эвентов",
        "info": "",
        "x": 150,
        "y": 40,
        "wires": []
    },
    {
        "id": "a4eb1569.fab608",
        "type": "function",
        "z": "6169ae85.ebde",
        "name": "Подготовка данных",
        "func": "msg.payload = \n{\n    \"message_id\": Number(msg.payload.event.message.message_id),\n    \"chat_id\": Number(msg.payload.event.chat_id),\n    \"message_text\": msg.payload.event.message.text.replace(/\\n/g, '\\\\n')\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 120,
        "y": 380,
        "wires": [
            [
                "ab24e64f.b73608"
            ]
        ]
    },
    {
        "id": "ab24e64f.b73608",
        "type": "api-call-service",
        "z": "6169ae85.ebde",
        "name": "Edit previous message",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "edit_message",
        "entityId": "",
        "data": "{\"message_id\":\"{{payload.message_id}}\",\"chat_id\":\"{{payload.chat_id}}\",\"message\":\"{{payload.message_text}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 360,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "ed7c6eda.b07c4",
        "type": "comment",
        "z": "6169ae85.ebde",
        "name": "Подготовка данных для отправки в телеграм",
        "info": "",
        "x": 200,
        "y": 340,
        "wires": []
    },
    {
        "id": "ae68b544.c1a7f8",
        "type": "server-state-changed",
        "z": "16ff52c4.88944d",
        "d": true,
        "name": "Мин температура днем",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "input_number.auto_heater_balcony_day_temp_min",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 220,
        "wires": [
            [
                "41442ad6.b2a134"
            ]
        ]
    },
    {
        "id": "ca2e9cfe.09056",
        "type": "server-state-changed",
        "z": "16ff52c4.88944d",
        "d": true,
        "name": "Мин температура ночью",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "input_number.auto_heater_balcony_night_temp_min",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 260,
        "wires": [
            [
                "41442ad6.b2a134"
            ]
        ]
    },
    {
        "id": "57733067.12e46",
        "type": "server-state-changed",
        "z": "16ff52c4.88944d",
        "d": true,
        "name": "Изменение диапазона",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "input_number.auto_heater_balcony_temp_range",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 180,
        "wires": [
            [
                "41442ad6.b2a134"
            ]
        ]
    },
    {
        "id": "7ccefdc3.a970c4",
        "type": "server-state-changed",
        "z": "16ff52c4.88944d",
        "d": true,
        "name": "Изменение температуры",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "sensor.xiaomi_thp_temperature_balcony_158d0002389f84",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 100,
        "wires": [
            [
                "41442ad6.b2a134"
            ]
        ]
    },
    {
        "id": "41442ad6.b2a134",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "Auto heat on?",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.auto_heater_balcony_switch",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 420,
        "y": 140,
        "wires": [
            [
                "372ee55.28e691a",
                "3c0e38c8.d110c8",
                "7f827176.df472",
                "51d8a594.84c39c",
                "ad0e3938.e83138",
                "65304db2.42eeb4"
            ],
            []
        ]
    },
    {
        "id": "a44a9133.dc675",
        "type": "debug",
        "z": "16ff52c4.88944d",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 1410,
        "y": 220,
        "wires": []
    },
    {
        "id": "721ea32e.aeb61c",
        "type": "change",
        "z": "16ff52c4.88944d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "day_temp",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 60,
        "wires": [
            [
                "5b7a751b.00ddec"
            ]
        ]
    },
    {
        "id": "5b7a751b.00ddec",
        "type": "join",
        "z": "16ff52c4.88944d",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "6",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1010,
        "y": 140,
        "wires": [
            [
                "ea3311f1.5c59a",
                "dbc5130.4510cf"
            ]
        ]
    },
    {
        "id": "372ee55.28e691a",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "Дневная T",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_number.auto_heater_balcony_day_temp_min",
        "state_type": "num",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 650,
        "y": 60,
        "wires": [
            [
                "721ea32e.aeb61c"
            ]
        ]
    },
    {
        "id": "3c0e38c8.d110c8",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "Ночная T",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_number.auto_heater_balcony_night_temp_min",
        "state_type": "num",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 640,
        "y": 100,
        "wires": [
            [
                "2e9e6624.96bfaa"
            ]
        ]
    },
    {
        "id": "2e9e6624.96bfaa",
        "type": "change",
        "z": "16ff52c4.88944d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "night_temp",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 100,
        "wires": [
            [
                "5b7a751b.00ddec"
            ]
        ]
    },
    {
        "id": "ea3311f1.5c59a",
        "type": "debug",
        "z": "16ff52c4.88944d",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 1210,
        "y": 220,
        "wires": []
    },
    {
        "id": "7f827176.df472",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "Диапазон",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_number.auto_heater_balcony_temp_range",
        "state_type": "num",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 640,
        "y": 140,
        "wires": [
            [
                "e7b1d6e4.1a4768"
            ]
        ]
    },
    {
        "id": "e7b1d6e4.1a4768",
        "type": "change",
        "z": "16ff52c4.88944d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "range",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 140,
        "wires": [
            [
                "5b7a751b.00ddec"
            ]
        ]
    },
    {
        "id": "51d8a594.84c39c",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "Температура",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.xiaomi_thp_temperature_balcony_158d0002389f84",
        "state_type": "num",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 660,
        "y": 180,
        "wires": [
            [
                "609c1bae.89cbd4"
            ]
        ]
    },
    {
        "id": "609c1bae.89cbd4",
        "type": "change",
        "z": "16ff52c4.88944d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "temp",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 180,
        "wires": [
            [
                "5b7a751b.00ddec"
            ]
        ]
    },
    {
        "id": "ad0e3938.e83138",
        "type": "time-range-switch",
        "z": "16ff52c4.88944d",
        "name": "",
        "lat": "55.65606",
        "lon": "37.74136",
        "startTime": "07:00",
        "endTime": "23:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 650,
        "y": 280,
        "wires": [
            [
                "a548b2d2.10a49"
            ],
            [
                "3f5dc86e.f73148"
            ]
        ]
    },
    {
        "id": "a548b2d2.10a49",
        "type": "change",
        "z": "16ff52c4.88944d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "time",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "day",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 260,
        "wires": [
            [
                "5b7a751b.00ddec"
            ]
        ]
    },
    {
        "id": "3f5dc86e.f73148",
        "type": "change",
        "z": "16ff52c4.88944d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "time",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "night",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 300,
        "wires": [
            [
                "5b7a751b.00ddec"
            ]
        ]
    },
    {
        "id": "dbc5130.4510cf",
        "type": "function",
        "z": "16ff52c4.88944d",
        "name": "Управление",
        "func": "var time=msg.payload.time;\nvar day_temp=msg.payload.day_temp;\nvar night_temp=msg.payload.night_temp;\nvar range=msg.payload.range;\nvar curr_temp=msg.payload.temp;\nvar heater=msg.payload.heater\n\n// Период\nif (time==\"day\"){\n    if ((curr_temp < day_temp) && (heater=='off')){\n        msg.payload=\"on\"; // Включить обогреватель\n        return msg;\n    }\n    if ((curr_temp > (day_temp + range)) && (heater=='on')){\n        msg.payload=\"off\"; // Выключить обогреватель\n        return msg;\n    }\n}\nif (time==\"night\"){\n    if ((curr_temp < night_temp) && (heater=='off')){\n        msg.payload=\"on\"; // Включить обогреватель\n        return msg;\n    }\n    if ((curr_temp > (night_temp + range)) && (heater=='on')){\n        msg.payload=\"off\"; // Выключить обогреватель\n        return msg;\n    }\n}\nmsg.payload=null\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1150,
        "y": 140,
        "wires": [
            [
                "ec57a7bd.7ff768",
                "a44a9133.dc675"
            ]
        ]
    },
    {
        "id": "ec57a7bd.7ff768",
        "type": "switch",
        "z": "16ff52c4.88944d",
        "name": "On/Off",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1290,
        "y": 140,
        "wires": [
            [
                "a45ce48b.ca68b8"
            ],
            [
                "7539b87a.f08508"
            ]
        ]
    },
    {
        "id": "a45ce48b.ca68b8",
        "type": "api-call-service",
        "z": "16ff52c4.88944d",
        "name": "Включить обогреватель",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "switch",
        "service": "turn_on",
        "entityId": "switch.plug_158d00032d5e8b",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1490,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "7539b87a.f08508",
        "type": "api-call-service",
        "z": "16ff52c4.88944d",
        "name": "Выключить обогреватель",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "switch",
        "service": "turn_off",
        "entityId": "switch.plug_158d00032d5e8b",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1500,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "79e92951.9e50e8",
        "type": "comment",
        "z": "16ff52c4.88944d",
        "name": "===================  Автоматический подогрев лоджии  ===================  ",
        "info": "",
        "x": 640,
        "y": 20,
        "wires": []
    },
    {
        "id": "a969674b.ca76b8",
        "type": "server-state-changed",
        "z": "16ff52c4.88944d",
        "d": true,
        "name": "Включение авто подогрева",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "input_boolean.auto_heater_balcony_switch",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 60,
        "wires": [
            [
                "41442ad6.b2a134"
            ]
        ]
    },
    {
        "id": "148d7b89.062e74",
        "type": "timerswitch",
        "z": "16ff52c4.88944d",
        "d": true,
        "name": "07:00 & 23:00",
        "ontopic": "",
        "offtopic": "",
        "onpayload": "time",
        "offpayload": "time",
        "disabled": false,
        "schedules": [
            {
                "on_h": "07",
                "on_m": "00",
                "on_s": "00",
                "off_h": "23",
                "off_m": "00",
                "off_s": "00",
                "valid": true
            }
        ],
        "x": 100,
        "y": 140,
        "wires": [
            [
                "41442ad6.b2a134"
            ]
        ]
    },
    {
        "id": "65304db2.42eeb4",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "Обогреватель",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "switch.plug_158d00032d5e8b",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 660,
        "y": 220,
        "wires": [
            [
                "55812462.c8a30c"
            ]
        ]
    },
    {
        "id": "55812462.c8a30c",
        "type": "change",
        "z": "16ff52c4.88944d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "heater",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 220,
        "wires": [
            [
                "5b7a751b.00ddec"
            ]
        ]
    },
    {
        "id": "dc113e4d.bc0c8",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg with actions",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"*Увлажнитель*\",\"message\":\"В увлажнителе осталось {{payload}}% воды. Что сделать?\",\"data\":{\"inline_keyboard\":[\"Выключить увлажнитель:/humidifier_off\",\"Поставить на мин. режим:/humidifier_low\",\"Ничего не делать:/none\"]}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "ae3b5f3b.86655",
        "type": "ha-get-entities",
        "z": "8d422126.121a1",
        "server": "6962e153.99eb9",
        "name": "Battery < 20",
        "rules": [
            {
                "property": "attributes.battery_level",
                "logic": "lt",
                "value": "20",
                "valueType": "num"
            }
        ],
        "output_type": "split",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 310,
        "y": 200,
        "wires": [
            [
                "5772e39a.c019fc",
                "5172a865.332878",
                "598aecbf.bbbdb4"
            ]
        ]
    },
    {
        "id": "344237e8.5e14f8",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "===================  Battery Check  ===================  ",
        "info": "",
        "x": 550,
        "y": 160,
        "wires": []
    },
    {
        "id": "5772e39a.c019fc",
        "type": "debug",
        "z": "8d422126.121a1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 530,
        "y": 260,
        "wires": []
    },
    {
        "id": "5172a865.332878",
        "type": "debug",
        "z": "8d422126.121a1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.attributes",
        "targetType": "msg",
        "x": 560,
        "y": 300,
        "wires": []
    },
    {
        "id": "598aecbf.bbbdb4",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"🔋 *Низкий заряд батарейки*\",\"message\":\"Устройство *{{payload.attributes.friendly_name}}* имеет заряд *{{payload.attributes.battery_level}}%*.\\n Необходимо заменить батарейку.\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 570,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "412e5894.6b01e8",
        "type": "ha-get-entities",
        "z": "8d422126.121a1",
        "server": "6962e153.99eb9",
        "name": "Battery < 10",
        "rules": [
            {
                "property": "attributes.battery_level",
                "logic": "lt",
                "value": "10",
                "valueType": "num"
            }
        ],
        "output_type": "split",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 310,
        "y": 260,
        "wires": [
            [
                "598aecbf.bbbdb4"
            ]
        ]
    },
    {
        "id": "48d2d4a1.a406bc",
        "type": "inject",
        "z": "8d422126.121a1",
        "name": "Sat, Sun 13:00",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "00 13 * * 6,0",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 200,
        "wires": [
            [
                "ae3b5f3b.86655"
            ]
        ]
    },
    {
        "id": "bc72916b.5fc0d",
        "type": "inject",
        "z": "8d422126.121a1",
        "name": "Every day 18:00",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "00 18 * * *",
        "once": false,
        "onceDelay": 0.1,
        "x": 130,
        "y": 260,
        "wires": [
            [
                "412e5894.6b01e8"
            ]
        ]
    },
    {
        "id": "75be9a60.a2cfe4",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "Мало воды",
        "info": "",
        "x": 90,
        "y": 1360,
        "wires": []
    },
    {
        "id": "4f1333f9.45c10c",
        "type": "inject",
        "z": "6169ae85.ebde",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 480,
        "wires": [
            [
                "fd6b1ff3.90d8b"
            ]
        ]
    },
    {
        "id": "fd6b1ff3.90d8b",
        "type": "api-call-service",
        "z": "6169ae85.ebde",
        "name": "Send telegram msg to Pinkkoff",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_pinkkoff",
        "entityId": "",
        "data": "{\"title\":\"*Тестовое сообщение*\",\"message\":\"Это сообщение пришло от Умного Дома.\\n Классно получилось?\",\"data\":{\"inline_keyboard\":[\"Володечка молодец:/command1, Ну такое...:/command2\"]}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "22551f21.387f3",
        "type": "inject",
        "z": "6169ae85.ebde",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 600,
        "wires": [
            [
                "e11b567c.695718"
            ]
        ]
    },
    {
        "id": "e11b567c.695718",
        "type": "api-call-service",
        "z": "6169ae85.ebde",
        "name": "Send telegram msg to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"*Тестовое сообщение*\",\"message\":\"Это сообщение пришло от *Умного Дома*.\\n Классно получилось?\",\"data\":{\"inline_keyboard\":[\"Володечка молодец:/command1, Ну такое...:/command2\"]}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 350,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "2567e1cd.2e2a2e",
        "type": "inject",
        "z": "6169ae85.ebde",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 540,
        "wires": [
            [
                "e5e13843.55fa48"
            ]
        ]
    },
    {
        "id": "e5e13843.55fa48",
        "type": "api-call-service",
        "z": "6169ae85.ebde",
        "name": "Send telegram msg to Fludshorty",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_fludshorty",
        "entityId": "",
        "data": "{\"title\":\"*Тестовое сообщение*\",\"message\":\"Это сообщение пришло от *Умного Дома*. Классно получилось?.\",\"data\":{\"inline_keyboard\":[\"Володечка молодец:/command1, Ну такое...:/command2\"]}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 380,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "720c8765.a27098",
        "type": "comment",
        "z": "6169ae85.ebde",
        "name": "Отправка телеграм сообщений",
        "info": "",
        "x": 150,
        "y": 440,
        "wires": []
    },
    {
        "id": "ee16f913.ca49a8",
        "type": "ha-get-entities",
        "z": "6169ae85.ebde",
        "server": "6962e153.99eb9",
        "name": "Все entities",
        "rules": [
            {
                "property": "entity_id",
                "logic": "does_not_include",
                "value": "xiaomi",
                "valueType": "str"
            }
        ],
        "output_type": "split",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 250,
        "y": 700,
        "wires": [
            [
                "57342609.2ef128"
            ]
        ]
    },
    {
        "id": "57342609.2ef128",
        "type": "switch",
        "z": "6169ae85.ebde",
        "name": "Статусы батареек",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "battery",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 430,
        "y": 700,
        "wires": [
            [
                "9e21c24e.6861e"
            ]
        ]
    },
    {
        "id": "9e21c24e.6861e",
        "type": "debug",
        "z": "6169ae85.ebde",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.entity_id",
        "targetType": "msg",
        "x": 640,
        "y": 700,
        "wires": []
    },
    {
        "id": "5da4912a.047ef",
        "type": "inject",
        "z": "6169ae85.ebde",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 700,
        "wires": [
            [
                "ee16f913.ca49a8"
            ]
        ]
    },
    {
        "id": "d34d9c21.be0f8",
        "type": "comment",
        "z": "6169ae85.ebde",
        "name": "Фильтр батареек",
        "info": "",
        "x": 100,
        "y": 660,
        "wires": []
    },
    {
        "id": "d9ac1cfa.d84a6",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "===================  Alarm Sensors  ===================  ",
        "info": "",
        "x": 570,
        "y": 360,
        "wires": []
    },
    {
        "id": "856d8bce.bb9288",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "Leak",
        "info": "",
        "x": 70,
        "y": 540,
        "wires": []
    },
    {
        "id": "eaf438bc.2cdac8",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Smoke sensor ON",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.xiaomi_smoke_kitchen_158d00028229a1",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 460,
        "wires": [
            [
                "91b315b1.7003e8"
            ],
            []
        ]
    },
    {
        "id": "2e1e95f6.5bf28a",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"❗️*ОПАСНОСТЬ❗️ Возможен пожар на кухне*🔥\",\"message\":\"Уровень задымления: {{data.attributes.Density}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 610,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "672d7f48.28336",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send sound push to all",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "ios_iphone_all",
        "entityId": "",
        "data": "{\"message\":\"Уровень задымления:{{data.attributes.Density}} \",\"title\":\"❗ОПАСНОСТЬ❗️ Возможен пожар на кухне🔥\",\"data\":{\"push\":{\"sound\":\"US-EN-Alexa-Smoke-Detected-Generic.wav\"}}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 600,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "91b315b1.7003e8",
        "type": "api-current-state",
        "z": "8d422126.121a1",
        "name": "Задымленность",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "binary_sensor.xiaomi_smoke_kitchen_158d00028229a1",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 330,
        "y": 460,
        "wires": [
            [
                "27cdffa3.800e7",
                "2e1e95f6.5bf28a",
                "672d7f48.28336",
                "a150322e.bbb5e"
            ]
        ]
    },
    {
        "id": "27cdffa3.800e7",
        "type": "debug",
        "z": "8d422126.121a1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 390,
        "y": 500,
        "wires": []
    },
    {
        "id": "a150322e.bbb5e",
        "type": "debug",
        "z": "8d422126.121a1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "data",
        "targetType": "msg",
        "x": 600,
        "y": 500,
        "wires": []
    },
    {
        "id": "fc17f3f1.d59ad",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Leak sensor ON",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.xiaomi_water_leak_",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 580,
        "wires": [
            [
                "ddfcfe38.1b09c",
                "dae259f6.37a788"
            ],
            []
        ]
    },
    {
        "id": "ddfcfe38.1b09c",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"❗*ОПАСНОСТЬ❗️Зафиксирована протечка*💧\",\"message\":\"Устройство: {{data.new_state.attributes.friendly_name}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "dae259f6.37a788",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send sound push to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "ios_iphone_all",
        "entityId": "",
        "data": "{\"title\":\"❗ОПАСНОСТЬ❗️Зафиксирована протечка💧\",\"message\":\"Устройство: {{data.new_state.attributes.friendly_name}}\",\"data\":{\"push\":{\"sound\":\"US-EN-Alexa-Water-Detected-Generic.wav\"}}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 360,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "3fc90600.0ce39a",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "===================  Device availability  ===================  ",
        "info": "",
        "x": 560,
        "y": 40,
        "wires": []
    },
    {
        "id": "d603d959.56b778",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"⚠️*Устройство недоступно в HA*\",\"message\":\"Имя устройства: *{{data.new_state.attributes.friendly_name}}*\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 530,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "d834a6e3.7c6148",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "State change to unavailable ",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": ".*",
        "entityidfiltertype": "regex",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "unavailable",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 80,
        "wires": [
            [
                "ed6e47de.4b74e8"
            ],
            []
        ]
    },
    {
        "id": "66881ac0.cd6f64",
        "type": "switch",
        "z": "7cf1202f.0fec5",
        "name": "<low-high<",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "high",
                "vt": "env"
            },
            {
                "t": "btwn",
                "v": "low",
                "vt": "env",
                "v2": "high",
                "v2t": "env"
            },
            {
                "t": "lt",
                "v": "low",
                "vt": "env"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 390,
        "y": 140,
        "wires": [
            [
                "5a8930d.d27e7d"
            ],
            [
                "bd08a965.f10ce8"
            ],
            [
                "5aec55b.90952ac"
            ]
        ]
    },
    {
        "id": "bd08a965.f10ce8",
        "type": "change",
        "z": "7cf1202f.0fec5",
        "name": "Normal",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "value",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "normal",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 140,
        "wires": [
            [
                "b50f5b7b.baa748"
            ]
        ]
    },
    {
        "id": "5a8930d.d27e7d",
        "type": "change",
        "z": "7cf1202f.0fec5",
        "name": "High",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "value",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "high",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 100,
        "wires": [
            [
                "b50f5b7b.baa748"
            ]
        ]
    },
    {
        "id": "5aec55b.90952ac",
        "type": "change",
        "z": "7cf1202f.0fec5",
        "name": "Low",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "value",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "low",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 180,
        "wires": [
            [
                "b50f5b7b.baa748"
            ]
        ]
    },
    {
        "id": "b50f5b7b.baa748",
        "type": "rbe",
        "z": "7cf1202f.0fec5",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 770,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "a5966c71.298fc",
        "type": "server-state-changed",
        "z": "ee1a9216.12937",
        "name": "state input_n_2",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "input_number.test_input_number_2",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 500,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "d737cfdc.c452d",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "5",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 360,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "62493dd0.c1ae44",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "6",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 560,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "6f75fb78.639a04",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "5.2",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 440,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "4d9deec5.86956",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "4.9",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 320,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "4ac43015.b7145",
        "type": "subflow:7cf1202f.0fec5",
        "z": "ee1a9216.12937",
        "name": "",
        "env": [
            {
                "name": "low",
                "type": "num",
                "value": "5"
            },
            {
                "name": "high",
                "type": "num",
                "value": "6"
            },
            {
                "name": "hysteresis",
                "type": "str",
                "value": "0.2"
            }
        ],
        "x": 290,
        "y": 400,
        "wires": [
            [
                "3572c9c6.146946",
                "5f07d9f1.195c08"
            ]
        ]
    },
    {
        "id": "724a9aa9.7153d4",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "6.1",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 600,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "3572c9c6.146946",
        "type": "debug",
        "z": "ee1a9216.12937",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 470,
        "y": 360,
        "wires": []
    },
    {
        "id": "5f07d9f1.195c08",
        "type": "debug",
        "z": "ee1a9216.12937",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 490,
        "y": 400,
        "wires": []
    },
    {
        "id": "8f62e8fc.ca77f8",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "5.3",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 480,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "c42eb8ae.0deee8",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "5.4",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 520,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "6b4dd9c9.6c54f8",
        "type": "rbe",
        "z": "7cf1202f.0fec5",
        "name": "Hysteresis",
        "func": "deadbandEq",
        "gap": "$(hysteresis)",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 200,
        "y": 140,
        "wires": [
            [
                "66881ac0.cd6f64"
            ]
        ]
    },
    {
        "id": "326866ef.f5eb6a",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "4.8",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 280,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "f1b5eddd.ae3e7",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "Smoke",
        "info": "",
        "x": 70,
        "y": 420,
        "wires": []
    },
    {
        "id": "e614eb5.dfb2118",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "===================  Climate messages  ===================",
        "info": "",
        "x": 590,
        "y": 680,
        "wires": []
    },
    {
        "id": "f4d62e5d.1b584",
        "type": "server-events",
        "z": "96899f2.417176",
        "name": "",
        "server": "6962e153.99eb9",
        "event_type": "telegram_callback",
        "x": 130,
        "y": 320,
        "wires": [
            [
                "cc89f692.d6b2c8",
                "f8694780.749d58"
            ]
        ]
    },
    {
        "id": "cc89f692.d6b2c8",
        "type": "switch",
        "z": "96899f2.417176",
        "name": "Команды callback",
        "property": "payload.event.data",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/none",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/humidifier_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/humidifier_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/humidifier_low",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/heater_balcony_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/heater_balcony_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/heater_balcony_auto_on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/heater_balcony_auto_off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 390,
        "y": 320,
        "wires": [
            [
                "e9b4c9ba.bf10f8"
            ],
            [
                "eaa985f6.fd5ca8"
            ],
            [
                "568b62ab.d5d33c"
            ],
            [
                "38b92f09.fe737"
            ],
            [
                "e49fcb15.76c378"
            ],
            [
                "4f8f9928.029688"
            ],
            [
                "8838bc46.c93f1"
            ],
            [
                "25315fc5.e7015"
            ]
        ]
    },
    {
        "id": "f8694780.749d58",
        "type": "switch",
        "z": "96899f2.417176",
        "name": "Выбор chat_id",
        "property": "payload.event.chat_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 400,
        "y": 120,
        "wires": [
            [
                "56433ff7.3ed2b"
            ]
        ]
    },
    {
        "id": "e9b4c9ba.bf10f8",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "None - Reply telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"message\":\"Действий не выбрано.\",\"target\":\"{{payload.event.message.chat.id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 680,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "eaa985f6.fd5ca8",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Включить увлажнитель",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "fan",
        "service": "turn_on",
        "entityId": "fan.xiaomi_humidifier_bedroom",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 670,
        "y": 220,
        "wires": [
            [
                "75d30a0d.ccd414"
            ]
        ]
    },
    {
        "id": "568b62ab.d5d33c",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Выключить увлажнитель",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "fan",
        "service": "turn_off",
        "entityId": "fan.xiaomi_humidifier_bedroom",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 670,
        "y": 260,
        "wires": [
            [
                "75d30a0d.ccd414"
            ]
        ]
    },
    {
        "id": "38b92f09.fe737",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Увлажнитель на минимум",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "fan",
        "service": "set_speed",
        "entityId": "fan.xiaomi_humidifier_bedroom",
        "data": "{\"speed\":\"silent\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 680,
        "y": 300,
        "wires": [
            [
                "f72cd7a9.82ba28"
            ]
        ]
    },
    {
        "id": "e49fcb15.76c378",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Heater balcony ON",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "switch",
        "service": "turn_on",
        "entityId": "switch.plug_158d00032d5e8b",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 650,
        "y": 340,
        "wires": [
            [
                "46605f89.f9267"
            ]
        ]
    },
    {
        "id": "4f8f9928.029688",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Heater balcony OFF",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "switch",
        "service": "turn_off",
        "entityId": "switch.plug_158d00032d5e8b",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 650,
        "y": 380,
        "wires": [
            [
                "46605f89.f9267"
            ]
        ]
    },
    {
        "id": "8838bc46.c93f1",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Auto heat balcony ON",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.auto_heater_balcony_switch",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 660,
        "y": 420,
        "wires": [
            [
                "46605f89.f9267"
            ]
        ]
    },
    {
        "id": "25315fc5.e7015",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Auto heat balcony OFF",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.auto_heater_balcony_switch",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 660,
        "y": 460,
        "wires": [
            [
                "46605f89.f9267"
            ]
        ]
    },
    {
        "id": "56433ff7.3ed2b",
        "type": "function",
        "z": "96899f2.417176",
        "name": "Подготовка данных",
        "func": "msg.payload = \n{\n    \"message_id\": Number(msg.payload.event.message.message_id),\n    \"chat_id\": Number(msg.payload.event.chat_id),\n    \"message_text\": msg.payload.event.message.text.replace(/\\n/g, '\\\\n')\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 620,
        "y": 120,
        "wires": [
            [
                "80a70e64.5716d"
            ]
        ]
    },
    {
        "id": "75d30a0d.ccd414",
        "type": "api-current-state",
        "z": "96899f2.417176",
        "name": "humidifier",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "fan.xiaomi_humidifier_bedroom",
        "state_type": "str",
        "state_location": "humidifier",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 900,
        "y": 240,
        "wires": [
            [
                "92f3a4a8.d63858"
            ]
        ]
    },
    {
        "id": "f72cd7a9.82ba28",
        "type": "api-current-state",
        "z": "96899f2.417176",
        "name": "humidifier_speed",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.xiaomi_humidifier_bedroom_mode",
        "state_type": "str",
        "state_location": "humidifier",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 930,
        "y": 300,
        "wires": [
            [
                "6aa0aef2.7d79b"
            ]
        ]
    },
    {
        "id": "46605f89.f9267",
        "type": "api-current-state",
        "z": "96899f2.417176",
        "name": "Heater",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "switch.plug_158d00032d5e8b",
        "state_type": "str",
        "state_location": "heater",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 870,
        "y": 400,
        "wires": [
            [
                "ea84e225.c4a3b"
            ]
        ]
    },
    {
        "id": "80a70e64.5716d",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Edit previous message",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "edit_message",
        "entityId": "",
        "data": "{\"message_id\":\"{{payload.message_id}}\",\"chat_id\":\"{{payload.chat_id}}\",\"message\":\"{{payload.message_text}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 860,
        "y": 120,
        "wires": [
            [
                "fdc336fb.d0b0c8"
            ]
        ]
    },
    {
        "id": "92f3a4a8.d63858",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Reply telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"title\":\"*Отработка команды*\",\"message\":\"Статус увлажнителя: {{humidifier}}\",\"target\":\"{{payload.event.message.chat.id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1160,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "6aa0aef2.7d79b",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Reply telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"title\":\"*Отработка команды*\",\"message\":\"Режим работы увлажнителя: {{humidifier}}\",\"target\":\"{{payload.event.message.chat.id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1160,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "ea84e225.c4a3b",
        "type": "api-current-state",
        "z": "96899f2.417176",
        "name": "Auto heat balcony",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.auto_heater_balcony_switch",
        "state_type": "str",
        "state_location": "auto_heat",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1020,
        "y": 400,
        "wires": [
            [
                "a24b876a.7664c8"
            ]
        ]
    },
    {
        "id": "fdc336fb.d0b0c8",
        "type": "debug",
        "z": "96899f2.417176",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 1070,
        "y": 120,
        "wires": []
    },
    {
        "id": "a24b876a.7664c8",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Reply telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"title\":\"*Отработка команды*\",\"message\":\"Статус обогревателя: *{{heater}}* \\nСтатус автоподогрева: *{{auto_heat}}*.\",\"target\":\"{{payload.event.message.chat.id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1220,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "a12b93fd.a4ef7",
        "type": "comment",
        "z": "96899f2.417176",
        "name": "Callback from messages",
        "info": "",
        "x": 130,
        "y": 280,
        "wires": []
    },
    {
        "id": "8cb7f120.23103",
        "type": "comment",
        "z": "96899f2.417176",
        "name": "Buttons delete after click",
        "info": "",
        "x": 430,
        "y": 80,
        "wires": []
    },
    {
        "id": "8a962a1a.51dc78",
        "type": "server-events",
        "z": "96899f2.417176",
        "name": "telegram_command",
        "server": "6962e153.99eb9",
        "event_type": "telegram_command",
        "x": 110,
        "y": 780,
        "wires": [
            [
                "487cf3ce.1cd95c"
            ]
        ]
    },
    {
        "id": "bcc11578.5edd48",
        "type": "switch",
        "z": "96899f2.417176",
        "name": "kiss",
        "property": "payload.event.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/поцелуй",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/целуй",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/Поцелуй",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/Целуй",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/kiss",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 370,
        "y": 860,
        "wires": [
            [
                "d36a2541.f65648"
            ],
            [
                "d36a2541.f65648"
            ],
            [
                "d36a2541.f65648"
            ],
            [
                "d36a2541.f65648"
            ],
            [
                "d36a2541.f65648"
            ]
        ]
    },
    {
        "id": "cf4fe9f2.624b38",
        "type": "switch",
        "z": "96899f2.417176",
        "name": "",
        "property": "payload.event.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "/start",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/help",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/exit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 370,
        "y": 720,
        "wires": [
            [
                "3939679f.3d3bd8"
            ],
            [
                "f9d2b907.a8aaa8"
            ],
            [
                "285d9a32.720da6"
            ]
        ]
    },
    {
        "id": "d36a2541.f65648",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Send telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"*Выполнение команды*\",\"message\":\"Целую {{payload.event.args.0}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 550,
        "y": 860,
        "wires": [
            [
                "6ea8cee5.ab701"
            ]
        ]
    },
    {
        "id": "6ea8cee5.ab701",
        "type": "debug",
        "z": "96899f2.417176",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 750,
        "y": 860,
        "wires": []
    },
    {
        "id": "1f2f9746.bb1499",
        "type": "comment",
        "z": "96899f2.417176",
        "name": "Команды поцелуев",
        "info": "",
        "x": 410,
        "y": 800,
        "wires": []
    },
    {
        "id": "157664ca.cc94eb",
        "type": "comment",
        "z": "96899f2.417176",
        "name": "/start, /help, /exit",
        "info": "",
        "x": 400,
        "y": 660,
        "wires": []
    },
    {
        "id": "912613a0.c800c",
        "type": "comment",
        "z": "96899f2.417176",
        "name": "===================  Callback Actions  ===================",
        "info": "",
        "x": 600,
        "y": 40,
        "wires": []
    },
    {
        "id": "b78a3abd.b7da28",
        "type": "comment",
        "z": "96899f2.417176",
        "name": "===================  Command Actions  ===================",
        "info": "",
        "x": 610,
        "y": 600,
        "wires": []
    },
    {
        "id": "5faa5de6.9e2f44",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Temp bedroom",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.xiaomi_thp_temperature_bedroom_158d00025f03f5",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 800,
        "wires": [
            [
                "531ed9d6.d350a8"
            ]
        ]
    },
    {
        "id": "531ed9d6.d350a8",
        "type": "subflow:7cf1202f.0fec5",
        "z": "8d422126.121a1",
        "name": "< 21 - 27 <",
        "env": [
            {
                "name": "low",
                "value": "21",
                "type": "num"
            },
            {
                "name": "high",
                "value": "27",
                "type": "num"
            },
            {
                "name": "hysteresis",
                "value": "0.2",
                "type": "str"
            }
        ],
        "x": 330,
        "y": 880,
        "wires": [
            [
                "32720bda.5cced4"
            ]
        ]
    },
    {
        "id": "8dab1d02.b193d",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Temp bathroom",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.xiaomi_thp_temperature_bathroom_158d00025f14c5",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 840,
        "wires": [
            [
                "531ed9d6.d350a8"
            ]
        ]
    },
    {
        "id": "32720bda.5cced4",
        "type": "function",
        "z": "8d422126.121a1",
        "name": "msg temp",
        "func": "// inputs var\nvar device_name = msg.data.new_state.attributes.friendly_name;\nvar curr_temp = msg.value;\nvar status = msg.payload;\n\n// Доступные иконки\n// 🥵 🥶 🙂 ☀️❄️👍\n\nif (status == \"high\") {\n    msg.title=\"🥵 *Стало слишком жарко!*\"\n} else if (status == \"normal\") {\n    msg.title=\"🙂 *Температура вернулась в норму.*\"\n} else if (status == \"low\") {\n    msg.title=\"🥶 *Стало слишком холодно!*\"\n} else {\n    msg.title=\"*Ошибка! Проверь flow оповещения по температуре.*\"\n}\n\nmsg.message = \"Устройство: *\" +  device_name + \"*.\\\\n \" +\n            \"Текущая температура: *\" + curr_temp + \"°C*.\"; \n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 880,
        "wires": [
            [
                "6b2c39aa.7fb4e8",
                "660c387f.3e4138"
            ]
        ]
    },
    {
        "id": "6b2c39aa.7fb4e8",
        "type": "debug",
        "z": "8d422126.121a1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 690,
        "y": 840,
        "wires": []
    },
    {
        "id": "660c387f.3e4138",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"{{title}}\",\"message\":\"{{message}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 750,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "e8df41cc.15ade",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "Temperature in usual rooms",
        "info": "",
        "x": 140,
        "y": 760,
        "wires": []
    },
    {
        "id": "28430f4d.f8204",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "=======  Оповещения о выходе за границы  =======",
        "info": "",
        "x": 580,
        "y": 720,
        "wires": []
    },
    {
        "id": "51f09e66.fb287",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "state temp balcony",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "sensor.xiaomi_thp_temperature_balcony_158d0002389f84",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 1060,
        "wires": [
            [
                "46c7faf8.4acd04"
            ]
        ]
    },
    {
        "id": "46c7faf8.4acd04",
        "type": "subflow:7cf1202f.0fec5",
        "z": "8d422126.121a1",
        "name": "< 2 - 35 <",
        "env": [
            {
                "name": "low",
                "type": "num",
                "value": "2"
            },
            {
                "name": "high",
                "type": "num",
                "value": "35"
            },
            {
                "name": "hysteresis",
                "type": "str",
                "value": "0.2"
            }
        ],
        "x": 300,
        "y": 1060,
        "wires": [
            [
                "4b3cd0b8.cc427"
            ]
        ]
    },
    {
        "id": "4b3cd0b8.cc427",
        "type": "api-current-state",
        "z": "8d422126.121a1",
        "name": "heater balcony",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "switch.plug_158d00032d5e8b",
        "state_type": "habool",
        "state_location": "heater",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 530,
        "y": 1020,
        "wires": [
            [
                "dfa82ba4.c665d8"
            ]
        ]
    },
    {
        "id": "dfa82ba4.c665d8",
        "type": "api-current-state",
        "z": "8d422126.121a1",
        "name": "auto heater balcony",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.auto_heater_balcony_switch",
        "state_type": "habool",
        "state_location": "auto",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 530,
        "y": 1060,
        "wires": [
            [
                "edfc54f2.e3cec8"
            ]
        ]
    },
    {
        "id": "edfc54f2.e3cec8",
        "type": "function",
        "z": "8d422126.121a1",
        "name": "msg temp balcony",
        "func": "// inputs var\nvar device_name = msg.data.new_state.attributes.friendly_name;\nvar curr_temp = msg.value;\nvar status = msg.payload;\nvar heater = msg.heater;\nvar auto = msg.auto;\n\n// Доступные иконки\n// 🥵 🥶 🙂 ☀️❄️👍\n\nif (status == \"high\") {\n    msg.title=\"🥵 *Стало слишком жарко!*\"\n} else if (status == \"normal\") {\n    msg.title=\"🙂 *Температура вернулась в норму.*\"\n} else if (status == \"low\") {\n    msg.title=\"🥶 *Стало слишком холодно!*\"\n} else {\n    msg.title=\"*Ошибка! Проверь flow оповещения по температуре.*\"\n}\n\nheater = (heater) ? \"*Включен*\" : \"*Выключен*\";\nauto = (auto) ? \"*Включен*\" : \"*Выключен*\";\n\nmsg.message =   \"Устройство: *\" +  device_name + \n                \"*.\\\\n\" + \"Текущая температура: *\" +\n                curr_temp + \"°C*.\" + \"\\\\n\" +\n                \"Обогреватель: \" + heater + \".\\\\n\" +\n                \"Авто оборгев: \" + auto + \".\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 540,
        "y": 1100,
        "wires": [
            [
                "f24f1f80.44a46",
                "7ce25ec7.25524",
                "d5a87e37.d7ae2"
            ]
        ]
    },
    {
        "id": "f24f1f80.44a46",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "d": true,
        "name": "Send telegram msg with actions",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"{{title}}\",\"message\":\"{{message}}\",\"data\":{\"inline_keyboard\":[\"Вкл обогрев:/heater_balcony_on, Выкл обогрев:/heater_balcony_off\",\"Вкл авто обогрев:/heater_balcony_auto_on, Выкл авто обогрев:/heater_balcony_auto_off\",\"Ничего не делать:/none\"]}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 830,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "7ce25ec7.25524",
        "type": "debug",
        "z": "8d422126.121a1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 750,
        "y": 1020,
        "wires": []
    },
    {
        "id": "4b86ad8b.0bd054",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "Temperature balcony with action",
        "info": "",
        "x": 140,
        "y": 1020,
        "wires": []
    },
    {
        "id": "46423fe5.033da",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "state hum bedroom",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "sensor.xiaomi_thp_humidity_bedroom_158d00025f03f5",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 1200,
        "wires": [
            [
                "e13a1eb1.4ed9e"
            ]
        ]
    },
    {
        "id": "e13a1eb1.4ed9e",
        "type": "subflow:7cf1202f.0fec5",
        "z": "8d422126.121a1",
        "name": "< 25 - 70 <",
        "env": [
            {
                "name": "low",
                "value": "25",
                "type": "num"
            },
            {
                "name": "high",
                "value": "70",
                "type": "num"
            },
            {
                "name": "hysteresis",
                "value": "3",
                "type": "str"
            }
        ],
        "x": 310,
        "y": 1200,
        "wires": [
            [
                "3d565c46.a724f4"
            ]
        ]
    },
    {
        "id": "3d565c46.a724f4",
        "type": "api-current-state",
        "z": "8d422126.121a1",
        "name": "humidifier",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "fan.xiaomi_humidifier_bedroom",
        "state_type": "habool",
        "state_location": "humidifier",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 540,
        "y": 1160,
        "wires": [
            [
                "c671be0b.ad746"
            ]
        ]
    },
    {
        "id": "c671be0b.ad746",
        "type": "api-current-state",
        "z": "8d422126.121a1",
        "name": "water level",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.xiaomi_humidifier_bedroom_water_level",
        "state_type": "num",
        "state_location": "water_level",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 530,
        "y": 1200,
        "wires": [
            [
                "2b21dda0.e162b2"
            ]
        ]
    },
    {
        "id": "2b21dda0.e162b2",
        "type": "function",
        "z": "8d422126.121a1",
        "name": "msg hum",
        "func": "// inputs var\nvar device_name = msg.data.new_state.attributes.friendly_name;\nvar curr_hum = msg.value;\nvar status = msg.payload;\nvar humidifier = msg.humidifier\nvar water_level = msg.water_level\n\n// Доступные иконки\n// 🥵 🥶 🙂 ☀️❄️👍 💧 ⚠️\n\nif (status == \"high\") {\n    msg.title=\"💧 *Cлишком большая влажность!*\"\n} else if (status == \"normal\") {\n    msg.title=\"👍 *Влажность вернулась в норму.*\"\n} else if (status == \"low\") {\n    msg.title=\"⚠️*Низкая влажность!*\"\n} else {\n    msg.title=\"*Ошибка! Проверь flow оповещения по температуре.*\"\n}\n\nhumidifier = (humidifier) ? \"*Включен*\" : \"*Выключен*\";\n\nmsg.message =   \"Устройство: *\" +  device_name + \"*.\\\\n\" + \n                \"Текущая влажность: *\" + curr_hum + \"%*.\\\\n\" +\n                \"Увлажнитель: \" + humidifier + \".\\\\n\" +\n                \"Уровень воды: *\" + water_level + \"%*.\"; \n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 540,
        "y": 1240,
        "wires": [
            [
                "294c1d89.0ec4e2",
                "a6e84d49.64306"
            ]
        ]
    },
    {
        "id": "294c1d89.0ec4e2",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg with actions",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"{{title}}\",\"message\":\"{{message}}\",\"data\":{\"inline_keyboard\":[\"Вкл увлажнитель:/humidifier_on, Выкл увлажнитель:/humidifier_off\",\"Ничего не делать:/none\"]}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 830,
        "y": 1200,
        "wires": [
            []
        ]
    },
    {
        "id": "a6e84d49.64306",
        "type": "debug",
        "z": "8d422126.121a1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 750,
        "y": 1160,
        "wires": []
    },
    {
        "id": "f821d4ef.1365c8",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "Humidity bedroom with action",
        "info": "",
        "x": 140,
        "y": 1140,
        "wires": []
    },
    {
        "id": "2e7bf33e.10e50c",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "===================  Devices issues  ===================",
        "info": "",
        "x": 580,
        "y": 1320,
        "wires": []
    },
    {
        "id": "a1607286.ba421",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "100",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 640,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "25a8611b.2bc31e",
        "type": "api-current-state",
        "z": "6a24dcbb.10a694",
        "name": "Auto mode on?",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.auto_light_bedroom_switch",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 560,
        "y": 220,
        "wires": [
            [
                "f4ab77e3.4a6438"
            ],
            []
        ]
    },
    {
        "id": "f4ab77e3.4a6438",
        "type": "api-current-state",
        "z": "6a24dcbb.10a694",
        "name": "GW light off?",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.gateway_light_7c49eb1babbf",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 730,
        "y": 220,
        "wires": [
            [
                "d03b3431.57ed68"
            ],
            [
                "a8727f2c.b0b2"
            ]
        ]
    },
    {
        "id": "d03b3431.57ed68",
        "type": "api-current-state",
        "z": "6a24dcbb.10a694",
        "name": "< 50 lx",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "50",
        "halt_if_type": "num",
        "halt_if_compare": "lt",
        "override_topic": false,
        "entity_id": "sensor.xiaomi_illumin_bathroom_158d0002b6e8e6",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 890,
        "y": 220,
        "wires": [
            [
                "f581c99e.07bae8"
            ],
            []
        ]
    },
    {
        "id": "bac8beae.34d61",
        "type": "trigger",
        "z": "6a24dcbb.10a694",
        "op1": "",
        "op2": "off",
        "op1type": "nul",
        "op2type": "str",
        "duration": "5",
        "extend": true,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "name": "Turn OFF in 5 min",
        "x": 1170,
        "y": 300,
        "wires": [
            [
                "9a60f576.904f48"
            ]
        ]
    },
    {
        "id": "2a17d1aa.13510e",
        "type": "api-call-service",
        "z": "6a24dcbb.10a694",
        "name": "Включить свет",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.gateway_light_7c49eb1babbf",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1240,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "68fd0602.fe7088",
        "type": "api-call-service",
        "z": "6a24dcbb.10a694",
        "name": "Выключить свет",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "light.gateway_light_7c49eb1babbf",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1550,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "74892b7a.c5d804",
        "type": "comment",
        "z": "6a24dcbb.10a694",
        "name": "Попробовать!",
        "info": "",
        "x": 90,
        "y": 200,
        "wires": []
    },
    {
        "id": "f581c99e.07bae8",
        "type": "change",
        "z": "6a24dcbb.10a694",
        "name": "Start automation",
        "rules": [
            {
                "t": "set",
                "p": "my_auto",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 220,
        "wires": [
            [
                "2a17d1aa.13510e"
            ]
        ]
    },
    {
        "id": "9a60f576.904f48",
        "type": "change",
        "z": "6a24dcbb.10a694",
        "name": "Stop automation",
        "rules": [
            {
                "t": "set",
                "p": "my_auto",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1360,
        "y": 300,
        "wires": [
            [
                "68fd0602.fe7088"
            ]
        ]
    },
    {
        "id": "360dbd94.5f0572",
        "type": "server-state-changed",
        "z": "6a24dcbb.10a694",
        "name": "Движение в ванной",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.xiaomi_motion_bathroom_158d0002b6e8e6",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 240,
        "wires": [
            [
                "bd031058.f7166"
            ]
        ]
    },
    {
        "id": "bd031058.f7166",
        "type": "rbe",
        "z": "6a24dcbb.10a694",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 270,
        "y": 240,
        "wires": [
            [
                "78bd0a5a.314724"
            ]
        ]
    },
    {
        "id": "78bd0a5a.314724",
        "type": "switch",
        "z": "6a24dcbb.10a694",
        "name": "ON / OFF",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 400,
        "y": 240,
        "wires": [
            [
                "25a8611b.2bc31e"
            ],
            [
                "60d19acb.b3d844"
            ]
        ]
    },
    {
        "id": "60d19acb.b3d844",
        "type": "switch",
        "z": "6a24dcbb.10a694",
        "name": "Is automation?",
        "property": "my_auto",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 980,
        "y": 300,
        "wires": [
            [
                "bac8beae.34d61"
            ]
        ]
    },
    {
        "id": "a8727f2c.b0b2",
        "type": "change",
        "z": "6a24dcbb.10a694",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 260,
        "wires": [
            [
                "60d19acb.b3d844"
            ]
        ]
    },
    {
        "id": "fe3db178.48f53",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "5.1",
        "payloadType": "num",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 400,
        "wires": [
            [
                "4ac43015.b7145"
            ]
        ]
    },
    {
        "id": "a709b975.7397d8",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Роутер",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.router_ping",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 70,
        "y": 1540,
        "wires": [
            [
                "50b77f93.f1d09"
            ],
            [
                "4d093ac3.d0c914"
            ]
        ]
    },
    {
        "id": "253f3160.60905e",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "NASMaster",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.nasmaster_ping",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1660,
        "wires": [
            [
                "50b77f93.f1d09"
            ],
            [
                "4d093ac3.d0c914"
            ]
        ]
    },
    {
        "id": "e0165a4f.a9ee18",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Xiaomi GW",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.xiaomi_gw1_ping",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1620,
        "wires": [
            [
                "50b77f93.f1d09"
            ],
            [
                "4d093ac3.d0c914"
            ]
        ]
    },
    {
        "id": "556188cc.810688",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Humidifier",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.xiaomi_humidifier_bedroom_ping",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 80,
        "y": 1580,
        "wires": [
            [
                "50b77f93.f1d09"
            ],
            [
                "4d093ac3.d0c914"
            ]
        ]
    },
    {
        "id": "1f678174.2292ff",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Odroid 1",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.odroid1_ping",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 80,
        "y": 1740,
        "wires": [
            [
                "50b77f93.f1d09"
            ],
            [
                "4d093ac3.d0c914"
            ]
        ]
    },
    {
        "id": "ffab80f8.fb3d8",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Odroid 2",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.odroid2_ping",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 80,
        "y": 1780,
        "wires": [
            [
                "50b77f93.f1d09"
            ],
            [
                "4d093ac3.d0c914"
            ]
        ]
    },
    {
        "id": "4d093ac3.d0c914",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All (unavailable)",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"⚠️ *Устройство недоступно*\",\"message\":\"Устройство *{{data.new_state.attributes.friendly_name}}* недоступно по сети.\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 550,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "215c021a.1b238e",
        "type": "comment",
        "z": "8d422126.121a1",
        "name": "Unavailable by ping",
        "info": "",
        "x": 110,
        "y": 1500,
        "wires": []
    },
    {
        "id": "50b77f93.f1d09",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All (available)",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"✅ *Устройство снова в сети*\",\"message\":\"Устройство *{{data.new_state.attributes.friendly_name}}* снова доступно по сети.\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 550,
        "y": 1600,
        "wires": [
            []
        ]
    },
    {
        "id": "ba0c85b9.189218",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "KidNAS",
        "server": "6962e153.99eb9",
        "version": 1,
        "entityidfilter": "binary_sensor.kidnas_ping",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 70,
        "y": 1700,
        "wires": [
            [
                "50b77f93.f1d09"
            ],
            [
                "4d093ac3.d0c914"
            ]
        ]
    },
    {
        "id": "2c10150f.85002a",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Reply telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"message\":\"{{{payload.message}}}\",\"target\":\"{{payload.event.chat_id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 780,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "3939679f.3d3bd8",
        "type": "function",
        "z": "96899f2.417176",
        "name": "start msg",
        "func": "message = \"👋 Привет, \" + msg.payload.event.from_first + \"!\\n\" +\n`Я бот Pinkkoff Smart Home.\n\nМое предназначение - оповещать о различных событиях внутри умного дома и реагировать на них.\nМои возможности:\n- оповещения о событиях\n- реакция на кнопки внутри сообщений\n- выполнение команд\n\nНажми на */help* чтобы узнать подробности!\n\n `\nmsg.payload.message = message.replace(/\\n/g, '\\\\n')\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 680,
        "wires": [
            [
                "2c10150f.85002a"
            ]
        ]
    },
    {
        "id": "770476a9.72f118",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Reply telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"message\":\"{{{payload.message}}}\",\"target\":\"{{payload.event.chat_id}}\",\"keyboard\":[\"/start, /help\",\"/status, /climate\",\"/all_light_off, /all_off\",\"/nobody_home, /smbd_home\",\"/exit\"]}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 780,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "f9d2b907.a8aaa8",
        "type": "function",
        "z": "96899f2.417176",
        "name": "help msg",
        "func": "message = \"Chat ID: \" + msg.payload.event.chat_id +\n\"\\nUser ID: \" + msg.payload.event.user_id +\n`\nТы можешь управлять кнопками снизу или вводом соответствующих команд.\n*Список доступных комманд*:\n*/start* - приветственное сообщение\n*/help* - помощь по командам\n*/status* - статус устройств дома\n*/climate* - климат дома\n*/all_light_off* - выключить весь свет\n*/all_off* - выключить всевозможные устройства\n*/nobody_home* - никого нет дома\n*/smbd_home* - дома кто-то есть\n*/exit* - закрыть панель с кнопками\n`\n//message = message.replace(/_/g, '\\\\\\\\_') //экранирование символов _ для markdown\nmessage = message.replace(/\\n/g, '\\\\n') // экранирование перехода строки для json\nmsg.payload.message = message\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 720,
        "wires": [
            [
                "770476a9.72f118"
            ]
        ]
    },
    {
        "id": "285d9a32.720da6",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Exit message",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"message\":\"Нажми /help если нужна помощь\",\"target\":\"{{payload.event.chat_id}}\",\"keyboard\":[]}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 600,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "bc665842.1549e8",
        "type": "api-call-service",
        "z": "ee1a9216.12937",
        "name": "Reply telegram msg",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"message\":\"/sss \\n /sss\\\\_s \\n /sss\\\\_ss\",\"target\":\"137569677\",\"keyboard\":[\"/start, /help\",\"/status, /climate\",\"/all_light_off, /all_of\",\"/nobody_home, /smbd_home\",\"/exit\"]}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 980,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "2f41ac83.cefb34",
        "type": "inject",
        "z": "ee1a9216.12937",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 740,
        "y": 220,
        "wires": [
            [
                "bc665842.1549e8"
            ]
        ]
    },
    {
        "id": "16facf79.1bdef1",
        "type": "comment",
        "z": "96899f2.417176",
        "name": "======  Остальные команды  ======",
        "info": "",
        "x": 470,
        "y": 940,
        "wires": []
    },
    {
        "id": "ec3035ce.dea868",
        "type": "switch",
        "z": "96899f2.417176",
        "name": "Команды",
        "property": "payload.event.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/status",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/climate",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/all_light_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/all_off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/nobody_home",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/smbd_home",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 380,
        "y": 1060,
        "wires": [
            [
                "22551676.fa9f7a"
            ],
            [
                "22551676.fa9f7a"
            ],
            [
                "22551676.fa9f7a"
            ],
            [
                "22551676.fa9f7a"
            ],
            [
                "22551676.fa9f7a"
            ],
            [
                "22551676.fa9f7a"
            ]
        ]
    },
    {
        "id": "22551676.fa9f7a",
        "type": "api-call-service",
        "z": "96899f2.417176",
        "name": "Сообщение заглушка",
        "server": "6962e153.99eb9",
        "version": 1,
        "service_domain": "telegram_bot",
        "service": "send_message",
        "entityId": "",
        "data": "{\"message\":\"Прости, команда находится в разработке\",\"target\":\"{{payload.event.chat_id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 640,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "487cf3ce.1cd95c",
        "type": "change",
        "z": "96899f2.417176",
        "name": "del bot name",
        "rules": [
            {
                "t": "change",
                "p": "payload.event.command",
                "pt": "msg",
                "from": "@pinkkoff_bot",
                "fromt": "str",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 150,
        "y": 900,
        "wires": [
            [
                "cf4fe9f2.624b38",
                "bcc11578.5edd48",
                "ec3035ce.dea868"
            ]
        ]
    },
    {
        "id": "932bf777.26f8c8",
        "type": "comment",
        "z": "6a24dcbb.10a694",
        "name": "Удалить, если хорошо работает ниже",
        "info": "",
        "x": 170,
        "y": 60,
        "wires": []
    },
    {
        "id": "481c8a3b.2077b4",
        "type": "server-state-changed",
        "z": "6a24dcbb.10a694",
        "name": "Nobody at home",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "group.smb_at_home",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "not_home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 660,
        "wires": [
            [
                "dfb8cec7.185bd"
            ],
            []
        ]
    },
    {
        "id": "dfb8cec7.185bd",
        "type": "api-call-service",
        "z": "6a24dcbb.10a694",
        "name": "Turn off the lights",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_off",
        "entityId": "group.all_lights",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "222f95a8.b270ea",
        "type": "api-call-service",
        "z": "6a24dcbb.10a694",
        "name": "Turn off the lights",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_off",
        "entityId": "group.all_lights",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 710,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "351aa0e2.775d3",
        "type": "server-state-changed",
        "z": "16ff52c4.88944d",
        "name": "Вытяжка",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "switch.xiaomi_wallswitch_bathroom_fan",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 80,
        "y": 380,
        "wires": [
            [
                "5d0d36c6.461f78"
            ],
            []
        ]
    },
    {
        "id": "5d0d36c6.461f78",
        "type": "trigger",
        "z": "16ff52c4.88944d",
        "op1": "",
        "op2": "off",
        "op1type": "nul",
        "op2type": "str",
        "duration": "45",
        "extend": true,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "name": "Turn OFF in 45 min",
        "x": 250,
        "y": 380,
        "wires": [
            [
                "48afe2a5.775b5c"
            ]
        ]
    },
    {
        "id": "48afe2a5.775b5c",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "fan on?",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "switch.xiaomi_wallswitch_bathroom_fan",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 420,
        "y": 380,
        "wires": [
            [
                "2eddfb87.2f2204"
            ],
            []
        ]
    },
    {
        "id": "2eddfb87.2f2204",
        "type": "api-call-service",
        "z": "16ff52c4.88944d",
        "name": "Turn fan off",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_off",
        "entityId": "switch.xiaomi_wallswitch_bathroom_fan",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 570,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "306bf669.6774fa",
        "type": "comment",
        "z": "16ff52c4.88944d",
        "name": "=== Автоотключение вытяжки ===  ",
        "info": "",
        "x": 160,
        "y": 340,
        "wires": []
    },
    {
        "id": "18f1d868.c5d1c8",
        "type": "server-state-changed",
        "z": "16ff52c4.88944d",
        "name": "Влажность в ванной",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.xiaomi_thp_humidity_bathroom_158d00025f14c5",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 480,
        "wires": [
            [
                "23d69e4f.fb1392"
            ]
        ]
    },
    {
        "id": "abac53aa.e57ff",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "fan on?",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "switch.xiaomi_wallswitch_bathroom_fan",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 660,
        "y": 480,
        "wires": [
            [],
            [
                "c0464c1c.3e713"
            ]
        ]
    },
    {
        "id": "c0464c1c.3e713",
        "type": "api-call-service",
        "z": "16ff52c4.88944d",
        "name": "Turn fan on",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_on",
        "entityId": "switch.xiaomi_wallswitch_bathroom_fan",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 810,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "edd5b30c.915d4",
        "type": "comment",
        "z": "16ff52c4.88944d",
        "name": "=== Автовключение вытяжки ===  ",
        "info": "",
        "x": 160,
        "y": 440,
        "wires": []
    },
    {
        "id": "23d69e4f.fb1392",
        "type": "api-current-state",
        "z": "16ff52c4.88944d",
        "name": "влажность в ванной",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.xiaomi_thp_humidity_bedroom_158d00025f03f5",
        "state_type": "num",
        "state_location": "hum",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 340,
        "y": 480,
        "wires": [
            [
                "bfd126f.901dfd8"
            ]
        ]
    },
    {
        "id": "bfd126f.901dfd8",
        "type": "switch",
        "z": "16ff52c4.88944d",
        "name": "diff  > 10 ",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "msg.hum + 10",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 480,
        "wires": [
            [
                "abac53aa.e57ff"
            ],
            []
        ]
    },
    {
        "id": "ed6e47de.4b74e8",
        "type": "switch",
        "z": "8d422126.121a1",
        "name": "Фильтр",
        "property": "data.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fan.xiaomi_humidifier_bedroom",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 340,
        "y": 80,
        "wires": [
            [],
            [
                "d603d959.56b778"
            ]
        ]
    },
    {
        "id": "3c29616.c5aad9e",
        "type": "trigger-state",
        "z": "8d422126.121a1",
        "name": "Вода в баке < 15%",
        "server": "6962e153.99eb9",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityid": "sensor.xiaomi_humidifier_bedroom_water_level",
        "entityidfiltertype": "exact",
        "debugenabled": false,
        "constraints": [
            {
                "id": "wnxzw30lbpa",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "<",
                "comparatorValueDatatype": "str",
                "comparatorValue": "15"
            },
            {
                "id": "a2h0mav1dqc",
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "previous_state",
                "propertyValue": "old_state.state",
                "comparatorType": ">=",
                "comparatorValueDatatype": "str",
                "comparatorValue": "15"
            }
        ],
        "constraintsmustmatch": "all",
        "outputs": 2,
        "customoutputs": [],
        "outputinitially": false,
        "state_type": "num",
        "x": 110,
        "y": 1445,
        "wires": [
            [
                "1c5a6dcc.a7c732"
            ],
            []
        ]
    },
    {
        "id": "75afbfa.06da54",
        "type": "api-current-state",
        "z": "8d422126.121a1",
        "name": "humidifier",
        "server": "6962e153.99eb9",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "fan.xiaomi_humidifier_bedroom",
        "state_type": "str",
        "state_location": "humidifier",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 480,
        "y": 1445,
        "wires": [
            [
                "d44da450.0d9578"
            ]
        ]
    },
    {
        "id": "1c5a6dcc.a7c732",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Humidifier off",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "fan",
        "service": "turn_off",
        "entityId": "fan.xiaomi_humidifier_bedroom",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 1445,
        "wires": [
            [
                "75afbfa.06da54"
            ]
        ]
    },
    {
        "id": "d44da450.0d9578",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send message to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"*Слишком мало воды\",\"message\":\"Увлажнитель в спальне был выключен (статус: {{humidifier}})\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 660,
        "y": 1445,
        "wires": [
            []
        ]
    },
    {
        "id": "3f36690c.eef696",
        "type": "server-state-changed",
        "z": "ee1a9216.12937",
        "name": "",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.last_boot",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 840,
        "y": 400,
        "wires": [
            [
                "8515fdc4.48d0d",
                "8d482329.a3523"
            ]
        ]
    },
    {
        "id": "8515fdc4.48d0d",
        "type": "debug",
        "z": "ee1a9216.12937",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1110,
        "y": 400,
        "wires": []
    },
    {
        "id": "8d482329.a3523",
        "type": "debug",
        "z": "ee1a9216.12937",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1090,
        "y": 440,
        "wires": []
    },
    {
        "id": "7060744d.45d0cc",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Temp living room",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.xiaomi_thp_temperature_livingroom_158d00046581b5",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 880,
        "wires": [
            [
                "531ed9d6.d350a8"
            ]
        ]
    },
    {
        "id": "5414be14.8282d",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Temp corridor",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.xiaomi_thp_temperature_corridor_158d000465887b",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 920,
        "wires": [
            [
                "531ed9d6.d350a8"
            ]
        ]
    },
    {
        "id": "f0ee3b05.9d3648",
        "type": "server-state-changed",
        "z": "8d422126.121a1",
        "name": "Temp cloakroom",
        "server": "6962e153.99eb9",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.xiaomi_thp_temperature_cloackroom_158d0004656f6d",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "num",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 960,
        "wires": [
            [
                "531ed9d6.d350a8"
            ]
        ]
    },
    {
        "id": "d5a87e37.d7ae2",
        "type": "api-call-service",
        "z": "8d422126.121a1",
        "name": "Send telegram msg to All",
        "server": "6962e153.99eb9",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "telegram_chat_all",
        "entityId": "",
        "data": "{\"title\":\"{{title}}\",\"message\":\"{{message}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 810,
        "y": 1100,
        "wires": [
            []
        ]
    }
]